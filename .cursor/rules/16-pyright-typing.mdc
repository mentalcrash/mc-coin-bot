---
description: Pyright Static Type Checking Rules (Strict Mode)
globs: **/*.py
alwaysApply: false
---

# ðŸ” Pyright Typing Standards (Strict Mode)

## 1. Core Philosophy: "Strict but Pragmatic"
- **Mode:** `strict` ëª¨ë“œë¥¼ ê¸°ë³¸ìœ¼ë¡œ í•©ë‹ˆë‹¤. ì´ëŠ” ëª¨ë“  ë³€ìˆ˜ì™€ í•¨ìˆ˜ì— **ëª…ì‹œì ì¸ íƒ€ìž…**ì´ ìžˆì–´ì•¼ í•¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
- **Ruff vs Pyright:**
    - **Ruff:** ìŠ¤íƒ€ì¼, ë¯¸ì‚¬ìš© ìž„í¬íŠ¸, ì½”ë“œ êµ¬ì¡° ê°œì„  (Linter).
    - **Pyright:** íƒ€ìž… í˜¸í™˜ì„±, ë…¼ë¦¬ì  ëª¨ìˆœ, `None` ì²˜ë¦¬ ê²€ì‚¬ (Type Checker).
    - **Rule:** Pyrightê°€ `reportUnusedImport` ë“±ì„ ë¬´ì‹œí•˜ë„ë¡ ì„¤ì •í–ˆìœ¼ë¯€ë¡œ, ê´€ë ¨ ì •ë¦¬ëŠ” Ruffì— ì˜ì¡´í•©ë‹ˆë‹¤.

## 2. Typing Syntax (Python 3.13)
- **Modern Generics:** `List`, `Dict`, `Tuple` (typing ëª¨ë“ˆ) ëŒ€ì‹  ë‚´ìž¥ `list[]`, `dict[]`, `tuple[]`ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
- **Union Types:** `Union[X, Y]` ëŒ€ì‹  `X | Y` ë¬¸ë²•ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
- **Type Aliases:** ë³µìž¡í•œ íƒ€ìž… ì •ì˜ ì‹œ `type` í‚¤ì›Œë“œ(Python 3.12+)ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
    - âœ… `type Price = Decimal`
    - âŒ `Price = Decimal`
- **Self Type:** ë©”ì„œë“œê°€ ìžê¸° ìžì‹ ì„ ë°˜í™˜í•˜ê±°ë‚˜ í´ëž˜ìŠ¤ íƒ€ìž…ì„ ì°¸ì¡°í•  ë•Œ `typing.Self`ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

## 3. Handling "Any" & External Libraries
- **Avoid `Any`:** `Any` ì‚¬ìš©ì€ ìµœëŒ€í•œ ì§€ì–‘í•©ë‹ˆë‹¤. ë°ì´í„° êµ¬ì¡°ë¥¼ ëª¨ë¥¼ ê²½ìš° `object`ë‚˜ `dict[str, Any]`ë¡œ ë²”ìœ„ë¥¼ ì¢ížˆì‹­ì‹œì˜¤.
- **External Libs (Pandas/CCXT):**
    - ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ íƒ€ìž… ì •ë³´ë¥¼ ì œê³µí•˜ì§€ ì•Šì•„ ì—ëŸ¬ê°€ ë°œìƒí•  ê²½ìš°, ìµœí›„ì˜ ìˆ˜ë‹¨ìœ¼ë¡œ `# type: ignore`ë¥¼ ì‚¬ìš©í•˜ë˜ ë°˜ë“œì‹œ **êµ¬ì²´ì ì¸ ì—ëŸ¬ ì½”ë“œ**ë¥¼ ëª…ì‹œí•´ì•¼ í•©ë‹ˆë‹¤.
    - âœ… `data = exchange.fetch_ticker() # type: ignore [reportUnknownMemberType]`
    - âŒ `data = exchange.fetch_ticker() # type: ignore` (ëª¨ë“  ì—ëŸ¬ ë¬´ì‹œ ê¸ˆì§€)
- **Casting:** íƒ€ìž… ì²´ì»¤ê°€ ì¶”ë¡ í•˜ì§€ ëª»í•˜ëŠ” í™•ì‹¤í•œ íƒ€ìž…ì€ `typing.cast()`ë¥¼ ì‚¬ìš©í•˜ì—¬ ëª…ì‹œí•©ë‹ˆë‹¤.

## 4. Specific Patterns for This Project

### ðŸ’° Decimal & Numbers
- ëª¨ë“  ê¸ˆìœµ ë°ì´í„°ëŠ” `Decimal` íƒ€ìž…ì„ ê°€ì§‘ë‹ˆë‹¤. `float`ì™€ í˜¼ìš© ì‹œ Pyrightê°€ ì—ëŸ¬ë¥¼ ë±‰ë„ë¡ ì„¤ê³„ë˜ì–´ ìžˆìœ¼ë¯€ë¡œ, ëª…ì‹œì  ë³€í™˜(`Decimal(str(float_val))`)ì„ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤.

### ðŸ›¡ï¸ Pydantic Models
- Pydantic V2 ëª¨ë¸ì€ Pyrightì™€ í˜¸í™˜ì„±ì´ ì¢‹ìœ¼ë‚˜, `model_validate` ì‚¬ìš© ì‹œ ìž…ë ¥ ë°ì´í„° íƒ€ìž…ì„ ì¶”ë¡ í•˜ê¸° ì–´ë ¤ìš¸ ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ì´ ê²½ìš° ìž…ë ¥ ë°ì´í„°ì˜ ê¸°ëŒ€ íƒ€ìž…ì„ ëª…í™•ížˆ í•˜ì‹­ì‹œì˜¤.

### ðŸ§© Async Tasks
- `asyncio.TaskGroup` ì‚¬ìš© ì‹œ, ë¹„ë™ê¸° í•¨ìˆ˜ì˜ ë°˜í™˜ íƒ€ìž…ì´ `Coroutine[Any, Any, None]` í˜•íƒœì¸ì§€ í™•ì¸í•˜ì‹­ì‹œì˜¤.

## 5. Example Pattern

### âœ… Good (Strict Compliant)
```python
from decimal import Decimal
from typing import Self, cast, Any

# Python 3.12+ Type Alias
type OrderID = str

class Position:
    def __init__(self, symbol: str, size: Decimal) -> None:
        self.symbol: str = symbol
        self.size: Decimal = size

    def add_size(self, amount: Decimal) -> Self:
        self.size += amount
        return self

    def get_metadata(self) -> dict[str, Any]:
        return {"created_at": "2026-01-27"}

def process_data(raw_data: object) -> None:
    # Safe Casting
    if isinstance(raw_data, str):
        print(f"String data: {raw_data}")
    else:
        # Unknown type handling
        val = cast(int, raw_data) # Only if you are 100% sure

```

### âŒ Bad (Loose Typing)

```python
from typing import List, Union # Legacy imports

def calculate(data) -> float: # Missing input type, Dangerous return type (float)
    # Implicit 'Any' type for 'data' triggers reportMissingParameterType
    return data * 1.5 

x = calculate(10)
x.invalid_method() # Pyright won't catch this because x is inferred as Any/float

```