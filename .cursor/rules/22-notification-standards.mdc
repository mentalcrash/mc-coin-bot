---
description: Notification Standards (Discord Webhooks, Rich Embeds, Async)
globs: **/notification/*.py, **/alerts/*.py, **/reporter/*.py
alwaysApply: false
---

# ğŸ“¢ Notification Standards (Discord First)

## 1. Platform Choice: Discord Webhooks
- **Protocol:** ë¬´ê±°ìš´ ë´‡ ë¼ì´ë¸ŒëŸ¬ë¦¬(`discord.py`) ëŒ€ì‹ , **Webhook ê¸°ë°˜ì˜ HTTP ìš”ì²­**ì„ í‘œì¤€ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
    - ì´ìœ : ìƒíƒœë¥¼ ìœ ì§€í•  í•„ìš”ê°€ ì—†ê³ (Stateless), ë¦¬ì†ŒìŠ¤ë¥¼ í›¨ì”¬ ì ê²Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
- **Library:** `aiohttp`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì „ì†¡í•©ë‹ˆë‹¤. `requests` ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©ì€ ê¸ˆì§€ë©ë‹ˆë‹¤(Blocking I/O).

## 2. Message Format: Rich Embeds
- **No Plain Text:** ë‹¨ìˆœ í…ìŠ¤íŠ¸ ë©”ì‹œì§€(`content` only) ì „ì†¡ì„ ì§€ì–‘í•©ë‹ˆë‹¤. ë°˜ë“œì‹œ **Embed Object**ë¥¼ ì‚¬ìš©í•´ ì‹œê°ì  ì •ë³´ë¥¼ ì „ë‹¬í•©ë‹ˆë‹¤.
- **Color Coding:** ìƒí™©ì— ë§ì¶° ì¸¡ë©´ ìƒ‰ìƒ(Color Bar)ì„ ì§€ì •í•©ë‹ˆë‹¤.
    - ğŸŸ¢ **Success/Buy:** Green (`0x00FF00` / `5763719`)
    - ğŸ”´ **Fail/Sell/Error:** Red (`0xFF0000` / `15548997`)
    - ğŸ”µ **Info/Summary:** Blue (`0x0000FF` / `3447003`)
    - ğŸŸ¡ **Warning:** Yellow (`0xFFFF00` / `16776960`)
- **Fields:** ì£¼ìš” ë°ì´í„°(ì§„ì…ê°€, ìˆ˜ëŸ‰, PnL)ëŠ” Embedì˜ `fields` ì†ì„±ì„ ì‚¬ìš©í•˜ì—¬ í‘œ(Table) í˜•íƒœë¡œ ì •ë ¬í•©ë‹ˆë‹¤.

## 3. Channel Segmentation Strategy
- **Topic Separation:** ë©”ì‹œì§€ ì„±ê²©ì— ë”°ë¼ ì„œë¡œ ë‹¤ë¥¸ Webhook URLì„ ì‚¬ìš©í•˜ë„ë¡ ì„¤ê³„í•©ë‹ˆë‹¤.
    - `TRADE_WEBHOOK_URL`: ë§¤ìˆ˜/ë§¤ë„ ì²´ê²° ì•Œë¦¼
    - `ERROR_WEBHOOK_URL`: ì‹œìŠ¤í…œ ì—ëŸ¬ ë° ì˜ˆì™¸ ë°œìƒ (ì¦‰ì‹œ í™•ì¸ í•„ìš”)
    - `REPORT_WEBHOOK_URL`: ì¼ì¼ ìˆ˜ìµë¥  ë¦¬í¬íŠ¸

## 4. Rate Limit Handling
- **Respect Limits:** ë””ìŠ¤ì½”ë“œ Webhook ë ˆì´íŠ¸ ë¦¬ë°‹(ì´ˆë‹¹ 5íšŒ ë“±)ì„ ê³ ë ¤í•˜ì—¬, ì•Œë¦¼ì´ í­ì£¼í•  ê²½ìš°ë¥¼ ëŒ€ë¹„í•œ **Buffer/Queue** ì‹œìŠ¤í…œì„ ê°–ì¶”ê±°ë‚˜ `aiohttp` ì¬ì‹œë„ ë¡œì§ì„ êµ¬í˜„í•´ì•¼ í•©ë‹ˆë‹¤.

## 5. Example Pattern

### âœ… Good (Async Webhook with Embed)
```python
import aiohttp
import json
from datetime import datetime
from enum import Enum

class DiscordColor(Enum):
    GREEN = 5763719
    RED = 15548997
    BLUE = 3447003

async def send_discord_alert(webhook_url: str, title: str, fields: list[dict], color: DiscordColor):
    """
    ë¹„ë™ê¸° Discord Embed ì „ì†¡ í•¨ìˆ˜
    """
    embed = {
        "title": title,
        "color": color.value,
        "fields": fields, # [{"name": "Price", "value": "100.0", "inline": True}, ...]
        "timestamp": datetime.utcnow().isoformat(),
        "footer": {"text": "MC-Coin-Bot â€¢ 2026 Edition"}
    }
    
    payload = {
        "username": "Quant Bot 2026",
        "avatar_url": "[https://imgur.com/bot_icon.png](https://imgur.com/bot_icon.png)",
        "embeds": [embed]
    }

    async with aiohttp.ClientSession() as session:
        try:
            async with session.post(webhook_url, json=payload) as response:
                if response.status != 204:
                    print(f"Failed to send alert: {await response.text()}")
        except Exception as e:
            # ì•Œë¦¼ ì „ì†¡ ì‹¤íŒ¨ê°€ ë©”ì¸ ë¡œì§ì„ ì£½ì´ë©´ ì•ˆ ë¨
            print(f"Notification Error: {e}")

# Usage inside Strategy
async def notify_buy(symbol, price, amount):
    await send_discord_alert(
        webhook_url=CONFIG.TRADE_URL,
        title=f"ğŸš€ BUY EXECUTED: {symbol}",
        fields=[
            {"name": "Price", "value": f"${price:,.2f}", "inline": True},
            {"name": "Amount", "value": f"{amount}", "inline": True},
            {"name": "Value", "value": f"${price*amount:,.2f}", "inline": True}
        ],
        color=DiscordColor.GREEN
    )

```

### âŒ Bad (Blocking & Plain Text)

```python
import requests # Blocking I/O

def send_alert(msg):
    # í…ìŠ¤íŠ¸ë§Œ ì „ì†¡ (ê°€ë…ì„± ë–¨ì–´ì§)
    requests.post(url, json={"content": msg}) 

```