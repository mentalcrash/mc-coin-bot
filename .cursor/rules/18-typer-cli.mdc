---
description: Typer CLI & Rich UI Standards (Modern CLI, Async Support)
globs: **/cli/*.py, **/main.py, **/scripts/*.py
alwaysApply: false
---

# ğŸ–¥ï¸ Typer CLI & Rich Standards (2026)

## 1. Modern Syntax (Annotated First)
- **Use `Annotated`:** Typerì˜ ì¸ì ì„¤ì •ì€ ë°˜ë“œì‹œ `typing.Annotated`ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. (Python 3.13 í‘œì¤€)
    - ì´ëŠ” Pydantic V2 ë° Pyrightì™€ ê°€ì¥ í˜¸í™˜ì„±ì´ ì¢‹ì€ íŒ¨í„´ì…ë‹ˆë‹¤.
    - âœ… `def main(name: Annotated[str, typer.Option(help="...")]):`
    - âŒ `def main(name: str = typer.Option(..., help="...")): ` (Legacy)

## 2. Rich UI Integration
- **No `print()` / No `typer.echo()`:** ì‚¬ìš©ì ì¶œë ¥ì€ ë°˜ë“œì‹œ **`rich`** ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
- **Components:**
    - **Status:** ë‹¨ìˆœ í…ìŠ¤íŠ¸ ëŒ€ì‹  `console.status("Processing...")` ìŠ¤í”¼ë„ˆë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
    - **Tables:** ë°ì´í„° ì¶œë ¥ ì‹œ `rich.table.Table`ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
    - **Panels:** ì¤‘ìš” ì•Œë¦¼ì´ë‚˜ ìš”ì•½ ì •ë³´ëŠ” `rich.panel.Panel`ë¡œ ê°ìŒ‰ë‹ˆë‹¤.
- **Global Console:** `src/core/console.py` ë“±ì— ì •ì˜ëœ ì‹±ê¸€í†¤ `Console` ê°ì²´ë¥¼ ì¬ì‚¬ìš©í•˜ì—¬ ìŠ¤íƒ€ì¼ ì¼ê´€ì„±ì„ ìœ ì§€í•©ë‹ˆë‹¤.

## 3. Command Architecture
- **Sub-commands:** ëª¨ë“  ëª…ë ¹ì–´ë¥¼ `main.py`ì— ëª°ì•„ë„£ì§€ ì•Šê³ , ê¸°ëŠ¥ë³„ë¡œ `typer.Typer()` ì•±ì„ ë¶„ë¦¬í•œ ë’¤ `app.add_typer()`ë¡œ ì¡°ë¦½í•©ë‹ˆë‹¤.
    - ì˜ˆ: `trade_app`, `backtest_app`, `config_app`
- **Graceful Exit:** ì˜¤ë¥˜ ë°œìƒ ì‹œ `sys.exit()` ëŒ€ì‹  `raise typer.Exit(code=1)`ì„ ì‚¬ìš©í•˜ì—¬ ê¹”ë”í•˜ê²Œ ì¢…ë£Œí•©ë‹ˆë‹¤.

## 4. Async Handling in CLI
- **Sync Entry -> Async Logic:** TyperëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë™ê¸°(Sync) ë°©ì‹ì…ë‹ˆë‹¤. ë¹„ë™ê¸° ë¡œì§ì„ í˜¸ì¶œí•  ë•ŒëŠ” ë™ê¸° ë˜í¼ í•¨ìˆ˜ ë‚´ì—ì„œ `asyncio.run()`ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
- **Pattern:**
    ```python
    @app.command()
    def start():
        # CLI Entrypoint (Sync)
        asyncio.run(start_bot_logic())
    ```

## 5. Example Pattern

### âœ… Good (Modern & Rich)
```python
import typer
import asyncio
from typing import Annotated
from rich.console import Console
from rich.panel import Panel

# Global Console Instance
console = Console()
app = typer.Typer(no_args_is_help=True)

async def _trade_logic(symbol: str, dry_run: bool):
    with console.status(f"[bold green]Starting trading bot for {symbol}..."):
        await asyncio.sleep(1) # Simulate init
        console.print(Panel(f"Market: {symbol}\nMode: {'DRY RUN' if dry_run else 'LIVE'}", title="Bot Started"))

@app.command()
def start(
    symbol: Annotated[str, typer.Option(help="Target Coin Pair")] = "BTC/USDT",
    dry_run: Annotated[bool, typer.Option("--dry-run", help="Test mode without real orders")] = False,
):
    """
    Start the crypto trading bot.
    """
    try:
        asyncio.run(_trade_logic(symbol, dry_run))
    except Exception as e:
        console.print(f"[bold red]Error:[/bold red] {e}")
        raise typer.Exit(code=1)

if __name__ == "__main__":
    app()

```

### âŒ Bad (Legacy)

```python
import typer

app = typer.Typer()

@app.command()
def start(symbol: str = typer.Option("BTC/USDT")): # Legacy Syntax
    # Ugly output
    print(f"Starting bot for {symbol}") 
    
    # Missing Async handling or dirty hack
    # No Error handling

```