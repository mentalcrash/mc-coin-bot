# 퀀트 전략 발굴부터 실전 배포까지: 완전 가이드 (2026)

> **목적**: 암호화폐 퀀트 전략의 아이디어 발굴에서 실전 배포까지 전체 과정을 단계별로 정리한다.
> 각 단계의 통과/탈락 기준, 분석 방법, 남겨야 할 데이터, 폐기/진행 의사결정 체계를 제공한다.
>
> **기준일**: 2026-02-09 | **대상**: MC Coin Bot (암호화폐 퀀트 트레이딩 시스템)

---

## 목차

1. [전체 흐름 한눈에 보기](#1-전체-흐름-한눈에-보기)
2. [0단계: 전략 아이디어 발굴](#2-0단계-전략-아이디어-발굴)
3. [1단계: 시제품 만들기 (표본 내 백테스트)](#3-1단계-시제품-만들기-표본-내-백테스트)
4. [2단계: 첫 번째 검증 (표본 내/외 분할)](#4-2단계-첫-번째-검증-표본-내외-분할)
5. [3단계: 파라미터 조율](#5-3단계-파라미터-조율)
6. [4단계: 심층 검증 (전진 분석/교차 검증/과적합 확률/보정 샤프)](#6-4단계-심층-검증)
7. [5단계: 다중 자산 포트폴리오 편입](#7-5단계-다중-자산-포트폴리오-편입)
8. [6단계: 모의 거래와 관찰 기간](#8-6단계-모의-거래와-관찰-기간)
9. [7단계: 실전 배포와 상시 감시](#9-7단계-실전-배포와-상시-감시)
10. [폐기 기준 종합표](#10-폐기-기준-종합표)
11. [파라미터 조율 워크플로우 상세](#11-파라미터-조율-워크플로우-상세)
12. [분석과 기록 표준](#12-분석과-기록-표준)
13. [알파 감쇠와 전략 은퇴](#13-알파-감쇠와-전략-은퇴)
14. [2025-2026년 동향과 교훈](#14-2025-2026년-동향과-교훈)
15. [MC Coin Bot 적용 안내](#15-mc-coin-bot-적용-안내)

---

## 1. 전체 흐름 한눈에 보기

```
┌───────────┐    ┌───────────┐    ┌───────────┐    ┌───────────┐
│ 0단계     │───▶│ 1단계     │───▶│ 2단계     │───▶│ 3단계     │
│ 아이디어  │    │ 시제품    │    │ 표본 내/외│    │ 파라미터  │
│ 발굴      │    │ 백테스트  │    │ 첫 검증   │    │ 조율      │
└───────────┘    └─────┬─────┘    └─────┬─────┘    └─────┬─────┘
                       │ 탈락           │ 탈락           │ 탈락
                       ▼                ▼                ▼
                   폐기 (60%)       폐기 (50%)       폐기 (40%)

┌───────────┐    ┌───────────┐    ┌───────────┐    ┌───────────┐
│ 4단계     │───▶│ 5단계     │───▶│ 6단계     │───▶│ 7단계     │
│ 심층 검증 │    │ 다중 자산 │    │ 모의 거래 │    │ 실전 배포 │
│ WFA/CPCV  │    │ 포트폴리오│    │ 관찰 기간 │    │ 상시 감시 │
└─────┬─────┘    └─────┬─────┘    └─────┬─────┘    └───────────┘
      │ 탈락           │ 탈락           │ 탈락
      ▼                ▼                ▼
  폐기 (30%)       폐기 (20%)       폐기 (10%)
```

**핵심 원칙**: 앞 단계에서 빠르게 걸러내고, 뒷 단계로 갈수록 신중하게 판단한다.

| 단계 | 소요 시간 | 통과율 | 핵심 질문 |
|------|----------|--------|----------|
| 0단계 | 1-2시간 | 40% | "이 우위가 왜 존재하는가?" |
| 1단계 | 2-4시간 | 40% | "기본 설정으로 돈을 버는가?" |
| 2단계 | 4-8시간 | 50% | "학습하지 않은 구간에서도 작동하는가?" |
| 3단계 | 1-2일 | 60% | "파라미터가 안정적인가?" |
| 4단계 | 1-2일 | 70% | "과적합이 아닌가?" |
| 5단계 | 1일 | 80% | "포트폴리오에 기여하는가?" |
| 6단계 | 2-4주 | 90% | "실시간 시장에서도 작동하는가?" |

**최종 생존율**: 아이디어 100개 중 실전에 투입되는 것은 2-3개뿐이다.

---

## 2. 0단계: 전략 아이디어 발굴

### 2.1 아이디어는 어디서 찾는가

| 출처 | 활용 방법 | 신뢰도 |
|------|----------|--------|
| **학술 논문** (SSRN, arXiv) | 검증된 시장 비정상 현상을 재현 | 최상 |
| **시장 미시구조 분석** | 호가창, 펀딩비, 미결제약정 패턴 관찰 | 상 |
| **온체인 데이터** | 스테이블코인 공급량, NVT, 고래 지갑 이동 | 상 |
| **기존 전략 변형** | 파라미터/시간대/자산을 바꿔서 재실험 | 중 |
| **타 시장 이식** | 주식/선물 전략을 암호화폐에 적용 | 중 |
| **대형 언어모델 탐색** | QuantEvolve 등 AI 기반 전략 생성 | 하 (반드시 검증 필요) |

### 2.2 아이디어를 걸러내는 세 가지 필수 질문

개발에 착수하기 전, 다음 세 질문에 답할 수 있어야 한다.

```
질문 1: "이 수익 기회는 왜 존재하는가?"
  → "행동 편향", "구조적 제약", "정보 비대칭" 가운데 하나로 설명할 수 있어야 한다.
  → 설명이 안 되면 데이터 채굴(data mining)일 가능성이 높다 → 폐기.

질문 2: "거래 상대방은 누구인가?"
  → 내가 돈을 벌려면 누군가는 잃어야 한다.
  → 상대방이 "정보 부족 개인 투자자"이면 → 지속 가능.
  → 상대방이 "같은 퀀트 트레이더"이면 → 알파가 빠르게 사라진다.

질문 3: "이미 과밀화(crowding)되지는 않았는가?"
  → 논문으로 공개된 시장 비정상 현상은 발표 후 평균 63% 샤프 비율 하락.
  → 알파는 매년 5-10% 속도로 감쇠한다.
```

### 2.3 아이디어 평가표

| 항목 | 점수 (1-5) | 기준 |
|------|-----------|------|
| 경제적 논거 | | 5=명확, 1=설명 불가 |
| 참신성 | | 5=미공개, 1=널리 알려짐 |
| 데이터 확보 가능성 | | 5=즉시 사용 가능, 1=별도 수집 필요 |
| 구현 난이도 | | 5=단순, 1=매우 복잡 |
| 예상 수용 용량 | | 5=대규모, 1=$100K 미만 |
| 시장 레짐 의존성 | | 5=전 시장, 1=특정 레짐만 |
| **합계** | **/30** | **18점 이상이면 1단계로 진행** |

### 2.4 남겨야 할 기록

```markdown
## 아이디어 기록 (0단계)
- 아이디어명:
- 작성일:
- 출처 (논문/관찰/직관):
- 경제적 논거:
- 예상 전략 유형: [추세추종 / 평균회귀 / 돌파 / 캐리 / 통계적]
- 예상 거래 빈도:
- 예상 보유 기간:
- 평가표 합계: /30
- 판정: [진행 / 폐기]
- 폐기 사유 (해당 시):
```

---

## 3. 1단계: 시제품 만들기 (표본 내 백테스트)

### 3.1 목적

**최소한의 노력으로** 아이디어가 수익을 낼 수 있는지 빠르게 확인한다.

### 3.2 실행 방법

```bash
# 기본 파라미터로 시제품 백테스트 실행
uv run python -m src.cli.backtest run {전략명} BTC/USDT \
  --start 2023-01-01 --end 2025-12-31
```

**반드시 지켜야 할 규칙:**
- 기본(default) 파라미터만 사용한다 — 이 단계에서 최적화는 금지
- 단일 자산(BTC/USDT) 기준으로 실행한다
- 거래 비용을 반드시 반영한다 (왕복 0.1%)
- 최소 2년 이상의 데이터를 사용한다 (상승장+하락장 1회 이상 포함)

### 3.3 통과/탈락 기준

| 지표 | 탈락 (즉시 폐기) | 관찰 | 통과 |
|------|-----------------|------|------|
| **샤프 비율 (표본 내)** | 0.5 미만 | 0.5 - 1.0 | **1.0 초과** |
| **총수익률** | 0% 미만 (손실) | 0-10% | 10% 초과 |
| **거래 횟수** | 20회 미만 | 20-50회 | **50회 초과** |
| **최대 낙폭** | 40% 초과 | 25-40% | 25% 미만 |
| **수익 계수** | 1.0 미만 | 1.0-1.3 | 1.3 초과 |

**즉시 폐기하는 경우:**
- 샤프 비율 0.5 미만이면서 거래 20회 미만 → 데이터 부족 + 성과 부진
- 총수익률이 마이너스 → 기본 아이디어 자체가 작동하지 않는다
- **샤프 비율이 3.0을 넘으면 오히려 의심** (초고빈도 전략 제외). 코드 버그 또는 미래 정보 참조(look-ahead bias) 가능성을 점검한다

### 3.4 주의해야 할 함정

| 함정 | 탐지 방법 | 대처 |
|------|----------|------|
| **미래 정보 참조** | `price_type="next_open"` 설정 확인 | `shift(1)` 적용 여부 점검 |
| **생존자 편향** | 상장폐지된 코인이 데이터에 포함되어 있는지 확인 | 최소 5개 코인으로 확인 |
| **거래 비용 누락** | 비용 모델 설정 확인 | 왕복 0.1% 필수 적용 |
| **짧은 검증 기간** | 1년 미만의 데이터 | 최소 2년 확보 |
| **단일 코인 편향** | BTC만으로 검증 | 5단계에서 다중 자산 검증 예정 |

### 3.5 남겨야 할 기록

```markdown
## 시제품 결과 (1단계)
- 전략명:
- 파라미터: [기본값 사용]
- 검증 기간: YYYY-MM-DD ~ YYYY-MM-DD
- 종목: BTC/USDT
- 거래 비용: 왕복 0.1%

### 성과 요약
| 지표 | 값 |
|------|-----|
| 샤프 비율 | |
| 연복리 수익률 | |
| 최대 낙폭 | |
| 총 거래 횟수 | |
| 수익 계수 | |
| 승률 | |

### 판정
- [ ] 통과 → 2단계로
- [ ] 관찰 → 조건부 진행 (사유: )
- [ ] 폐기 (사유: )
```

---

## 4. 2단계: 첫 번째 검증 (표본 내/외 분할)

### 4.1 목적

표본 내(IS)에서 학습한 패턴이 표본 외(OOS)에서도 작동하는지 확인한다.

### 4.2 실행 방법

```bash
# 빠른 검증 모드 (70/30 분할)
uv run python -m src.cli.backtest validate -m quick
```

**진행 절차:**
- 전체 데이터를 시간 순서대로 70:30으로 나눈다 (앞 70%가 표본 내, 뒤 30%가 표본 외)
- 표본 내에서 파라미터를 최적화한다
- 표본 외에서 성과를 확인한다
- **표본 외 데이터는 단 한 번만 사용한다** — 여러 번 들여다보면 정보가 새어나간다

### 4.3 통과/탈락 기준

| 지표 | 탈락 | 관찰 | 통과 |
|------|------|------|------|
| **표본 외 샤프** | 0.3 미만 | 0.3-0.5 | **0.5 초과** |
| **샤프 감쇠율** | 70% 초과 | 50-70% | **50% 미만** |
| **표본 외 수익률** | 0% 미만 | 0-5% | 5% 초과 |
| **표본 외 최대 낙폭** | 30% 초과 | 20-30% | 20% 미만 |
| **표본 외 거래 횟수** | 10회 미만 | 10-30회 | 30회 초과 |

**샤프 감쇠율 계산 방법:**

```
샤프 감쇠율 = 1 - (표본 외 샤프 / 표본 내 샤프)

사례:
  표본 내 2.0, 표본 외 1.2 → 감쇠 40% → 통과
  표본 내 2.0, 표본 외 0.5 → 감쇠 75% → 탈락
```

### 4.4 해석 안내

| 표본 내 샤프 | 표본 외 샤프 | 감쇠율 | 해석 | 판정 |
|-------------|------------|-------|------|------|
| 2.5 | 1.5 | 40% | 정상적인 감쇠 | 통과 |
| 2.5 | 0.8 | 68% | 위험 수준 | 관찰 |
| 2.5 | 0.2 | 92% | 과적합 확실 | 탈락 |
| 1.2 | 1.0 | 17% | 매우 안정적 | 통과 (이상적) |
| 1.0 | 1.3 | -30% | 표본 외가 더 좋음 | 관찰 (행운 가능성) |

### 4.5 "한 번 더 기회" 원칙

2단계에서 '관찰' 판정을 받았을 때:
1. **파라미터를 바꾸지 않고** 다른 자산(ETH/USDT)으로 재검증한다
2. 다른 자산에서도 관찰/탈락이면 → 폐기
3. 다른 자산에서 통과하면 → 3단계로 진행 (조건부)

---

## 5. 3단계: 파라미터 조율

### 5.1 목적

전략의 파라미터를 다듬되, **과적합에 빠지지 않는 것**이 핵심이다.

> **마음가짐**: "최고 성과를 내는 파라미터 하나"가 아니라 "넓은 범위에서 안정적으로 수익을 내는 파라미터 구간"을 찾는다.

### 5.2 조율 우선순위

```
1순위 — 신호 파라미터 (무엇을 거래할 것인가)
  └─ 되돌아보기 기간, 진입/청산 임계값, 지표 설정
  └─ 전략의 본질을 결정하므로 가장 먼저 다룬다

2순위 — 위험 관리 파라미터 (얼마나 위험을 감수할 것인가)
  └─ 손절선, 추적 손절, ATR 배수
  └─ 수익보다 낙폭 관리를 우선한다

3순위 — 실행 파라미터 (언제 집행할 것인가)
  └─ 진입 지연, 체결 방식
  └─ 미세 조정 단계

4순위 — 포트폴리오 파라미터 (어떻게 배분할 것인가)
  └─ 재조정 임계값, 비중 상한
  └─ 5단계에서 별도로 다룬다
```

### 5.3 고원 분석 — 가장 중요한 기법

**목표**: 성과 곡선에서 뾰족한 봉우리(peak)가 아닌 **넓고 평평한 고원(plateau)**을 찾는다.

```
파라미터 P를 넓은 범위에서 바꿔가며 백테스트:

  샤프
  2.0 ┤
      │           ╭────────╮
  1.5 ┤      ╭────╯        ╰────╮
      │  ╭───╯                   ╰───╮
  1.0 ┤──╯                           ╰──
      │
  0.5 ┤
      └──┬──┬──┬──┬──┬──┬──┬──┬──┬──┬──
         10 15 20 25 30 35 40 45 50 55 60  ← 파라미터 값

  좋은 패턴 — 고원 (20-40): 안정적이다 → 가운데 값(30)을 선택
  나쁜 패턴 — 뾰족한 봉우리: 과적합이다 → 그 파라미터를 쓰면 안 된다
```

**고원인가, 봉우리인가 판별하기:**

| 패턴 | 설명 | 판정 |
|------|------|------|
| **넓은 고원** | 파라미터를 ±30% 바꿔도 샤프가 ±10% 이내 | 안정적 |
| **좁은 봉우리** | 파라미터를 ±10%만 바꿔도 샤프가 30% 이상 변동 | 과적합 |
| **단조 증가/감소** | 파라미터가 커질수록(또는 작을수록) 성과가 계속 좋아짐 | 경계값 의존 (주의) |
| **무질서** | 아무 규칙 없이 들쑥날쑥 | 유의미한 신호 없음 |

### 5.4 ±20% 민감도 시험 (필수)

최적 파라미터를 선택한 뒤, **모든 파라미터를 동시에 ±20% 흔들어본다**:

```python
# 모든 파라미터를 +20% 적용
params_high = {k: v * 1.2 for k, v in optimal_params.items()}
result_high = backtest(params_high)

# 모든 파라미터를 -20% 적용
params_low = {k: v * 0.8 for k, v in optimal_params.items()}
result_low = backtest(params_low)

# 판정
if result_high.sharpe > 0 and result_low.sharpe > 0:
    print("통과: 파라미터가 안정적이다")
else:
    print("탈락: 파라미터가 취약하다 → 과적합 가능성")
```

| 결과 | 판정 |
|------|------|
| ±20%에서 샤프가 양수를 유지 | 견고함 |
| ±20%에서 샤프 부호가 바뀜 | 취약함 → 폐기 또는 재설계 |
| ±20%에서 최대 낙폭이 2배 이상 늘어남 | 위험 관리 파라미터 재검토 |

### 5.5 파라미터 탐색 방법 비교

| 방법 | 장점 | 단점 | 적합한 경우 |
|------|------|------|------------|
| **격자 탐색** | 전체 공간을 빠짐없이 탐색, 직관적 | 차원이 늘면 계산량 폭발 | 파라미터 2-3개 |
| **무작위 탐색** | 격자보다 효율적 | 최적해 보장 안 됨 | 파라미터 4-5개 |
| **베이지안 (Optuna)** | 수렴이 빠르고 효율적 | 과적합 위험 높음 | 검증 병행 필수 |
| **진화 알고리즘** | 복잡한 공간 탐색에 강함 | 재현성 낮음 | 연구 목적 |

**2025-2026년 업계 합의**: 진화 알고리즘 + 격자 탐색 조합이 가장 안정적이다.
베이지안은 빠르지만 과적합 경향이 있으므로 반드시 표본 외 검증을 동반해야 한다.

### 5.6 과적합 방지 점검표

```
□ 1. 표본 외 데이터 30%는 절대 건드리지 않는다 (봉인)
□ 2. 거래 횟수 100회 이상을 확보한다 (통계적 유의성)
□ 3. 파라미터 수를 5개 이내로 유지한다 (단순할수록 좋다)
□ 4. 고원 분석을 통과했다 (±20% 안정)
□ 5. 다른 자산에서도 검증했다 (BTC 외 2개 이상)
□ 6. 수익 계수가 4.0 미만이다 (비정상적으로 높으면 과적합)
□ 7. 샤프 비율이 3.0 미만이다 (비정상적으로 높으면 과적합, 초고빈도 제외)
□ 8. 소수점 단위까지 최적화하지 않았다 (정수 위주로 설정)
```

### 5.7 남겨야 할 기록

```markdown
## 파라미터 조율 결과 (3단계)

### 민감도 분석
| 파라미터 | 탐색 범위 | 고원 구간 | 선택값 | 안정성 |
|----------|----------|----------|--------|--------|
| 되돌아보기 기간 | 10-60 | 20-40 | 30 | 안정적 |
| 목표 변동성 | 0.1-0.5 | 0.2-0.35 | 0.30 | 안정적 |
| ATR 배수 | 1.0-5.0 | 해당 없음 (단조) | 3.0 | 경계값 주의 |

### ±20% 시험
| 시나리오 | 샤프 | 최대 낙폭 | 거래 수 | 판정 |
|----------|------|----------|---------|------|
| 최적값 | 1.8 | -15% | 142 | 통과 |
| 전부 +20% | 1.3 | -18% | 128 | 통과 |
| 전부 -20% | 1.1 | -20% | 156 | 통과 |

### 총 시행 횟수: N = [반드시 기록 — 보정 샤프(DSR) 계산에 필요]
```

---

## 6. 4단계: 심층 검증

### 6.1 목적

통계적 방법으로 전략이 **과적합이 아님**을 증명한다.

> 이 단계는 "전략이 좋다"를 증명하는 것이 아니다. "전략이 나쁘지 않다(=우연이 아니다)"를 증명하는 것이다.

### 6.2 전진 분석 (Walk-Forward Analysis)

**개념**: 데이터를 여러 구간으로 나눈 뒤, "과거로 최적화하고 미래로 시험"하는 과정을 반복한다.

```
┌────표본 내──────────┐┌─표본 외─┐
│████████████████████│▒▒▒▒▒▒▒│              구간 1
└────────────────────┘└───────┘
         ┌────표본 내──────────┐┌─표본 외─┐
         │████████████████████│▒▒▒▒▒▒▒│   구간 2
         └────────────────────┘└───────┘
                  ┌────표본 내──────────┐┌─표본 외─┐
                  │████████████████████│▒▒▒▒▒▒▒│   구간 3
                  └────────────────────┘└───────┘
```

**설정 권장값:**

| 항목 | 권장값 | 암호화폐 특수 사항 |
|------|--------|------------------|
| 표본 내:외 비율 | 4:1 | 2년 내 : 6개월 외 |
| 구간 수 | 6-10개 | 최소 6개 |
| 이동 방식 | 이동창(Rolling) | 암호화폐는 시장 레짐이 빠르게 바뀌므로 이동창 방식 추천 |
| 최소 표본 내 기간 | 2년 | 상승+하락 1주기 이상 |

**전진 분석 효율(WFE):**

```
전진 분석 효율 = (표본 외 연환산 수익률) / (표본 내 연환산 수익률) × 100%
```

| 효율 | 해석 | 판정 |
|------|------|------|
| **60% 이상** | 우수 — 견고한 전략 | 통과 |
| **50-60%** | 최소 수용 수준 | 조건부 통과 |
| **50% 미만** | 과적합 가능성 높음 | 탈락 |
| **300% 이상** | 비정상 — 표본 외가 표본 내보다 훨씬 좋음 | 행운 가능성 점검 |

**추가 통과 조건:**
- 표본 외 샤프가 양수인 구간의 비율이 60% 이상
- 파라미터가 구간 간에 ±20% 이내로 변동
- 표본 외 최대 낙폭이 40% 미만

### 6.3 조합적 정제 교차검증 (CPCV)

**개념**: 가능한 모든 표본 내/외 조합을 시험하여 과적합 확률을 수치화한다.

```
데이터를 S개 블록으로 나눈다 (권장 S=8)
→ C(8,4) = 70가지 내/외 조합을 만든다
→ 각 조합에서 표본 내 최적 전략의 표본 외 순위를 기록한다
→ 표본 외에서 중간값 이하인 빈도 = 과적합 확률(PBO)
```

**설정 권장값:**

| 항목 | 권장값 |
|------|--------|
| 분할 수 (S) | 8-16 |
| 시험 분할 수 | S/2 |
| 정제 구간 | 최대 보유기간의 2배 이상 |
| 유예 구간 | 전체 데이터 길이의 1% |

### 6.4 백테스트 과적합 확률 (PBO)

| PBO | 해석 | 판정 |
|-----|------|------|
| **25% 미만** | 과적합 위험 낮음 | 통과 |
| 25-40% | 중간 위험 | 추가 검증 필요 |
| **40% 초과** | 과적합 위험 높음 | 탈락 |
| 75% 초과 | 연구 과정 자체에 결함 | 전면 재설계 |

**중요한 점**: PBO가 50%를 넘으면 특정 전략이 아니라 **연구 방법론 전체**에 문제가 있다는 뜻이다.
"이런 식으로 전략을 찾는 행위 자체가 과적합을 만들어낸다"는 경고다.

### 6.5 보정 샤프 비율 (DSR)

**개념**: N번 시행한 뒤 가장 좋은 샤프를 골라내면, 그 값은 실제보다 부풀려져 있다. DSR은 이를 보정한다.

**핵심 입력값:**
- N = 총 시행 횟수 (전략 변형 수 × 파라미터 조합 수)
- T = 백테스트 기간 (일 수)
- 수익률의 왜도(skewness)와 첨도(kurtosis)

| DSR p-값 | 해석 | 판정 |
|----------|------|------|
| **0.95 초과** | 95% 이상의 신뢰도로 진짜 양의 샤프 | 통과 |
| 0.80-0.95 | 중간 신뢰도 | N을 줄이거나 T를 늘린다 |
| **0.80 미만** | 과적합 가능성 높음 | 탈락 |

**실전 사례:**
```
샤프 = 2.5, N = 100번 시행, T = 1,250일, 왜도 = -3, 첨도 = 10
→ DSR = 0.90 (95% 기준 미달)
→ 겉보기엔 샤프 2.5로 훌륭해 보이지만, 100번 시도한 결과물이므로 신뢰하기 어렵다
```

**N 관리가 핵심이다:**
- N이 클수록 DSR 통과가 어려워진다
- **시행 횟수를 전부 빠짐없이 기록**해야 정확한 DSR 계산이 가능하다
- "좋아 보이는 결과만 골라서 보고"하면 DSR 자체가 무의미해진다

### 6.6 MC Coin Bot에서 검증 실행하기

```bash
# 전진 분석 (구간별 확인)
uv run python -m src.cli.backtest validate -m milestone

# 심층 검증 (CPCV + 몬테카를로 + DSR + PBO)
uv run python -m src.cli.backtest validate -m final
```

### 6.7 종합 판정

```
통과 (모든 조건 충족):
  - 전진 분석 효율 50% 이상
  - PBO 40% 미만
  - DSR 0.95 초과
  - 표본 외 집계 샤프 0.5 초과
  - 파라미터가 구간 간에 안정적

탈락 (하나라도 해당):
  - 전진 분석 효율 50% 미만
  - PBO 50% 초과
  - DSR 0.80 미만
  - 수익률이 음수인 구간이 50% 이상
```

### 6.8 남겨야 할 기록

```markdown
## 심층 검증 결과 (4단계)

### 전진 분석
| 구간 | 표본 내 샤프 | 표본 외 샤프 | 효율 | 파라미터 |
|------|-------------|------------|------|---------|
| 1 | | | | |
| 2 | | | | |
| ... | | | | |
| 평균 | | | | |

### CPCV / PBO
- 분할 수: S = 8
- 조합 수: 70
- **PBO = XX%**

### 보정 샤프 비율 (DSR)
- 총 시행 횟수 (N): [매우 중요!]
- 백테스트 기간 (T): 일
- 선택된 샤프:
- 왜도:
- 첨도:
- **DSR p-값 = XX**

### 판정
- [ ] 통과 → 5단계로
- [ ] 탈락 → 폐기 (사유: )
```

---

## 7. 5단계: 다중 자산 포트폴리오 편입

### 7.1 목적

단일 자산에서 검증된 전략을 **다중 자산 포트폴리오에 편입**했을 때 분산 효과가 있는지 확인한다.

### 7.2 검증 절차

```bash
# 5개 코인 균등 배분 백테스트
uv run python -m src.cli.backtest run-multi {전략명} \
  --start 2023-01-01 --end 2025-12-31
```

**순서:**
1. 같은 전략을 5-8개 코인에 각각 적용 → 개별 성과를 확인한다
2. 균등 배분(EW) 포트폴리오를 구성한다 → 통합 성과를 확인한다
3. 기존 포트폴리오에 추가했을 때의 **한계 샤프 기여도**를 계산한다

### 7.3 통과/탈락 기준

| 지표 | 탈락 | 관찰 | 통과 |
|------|------|------|------|
| **균등 배분 샤프** | 0.5 미만 | 0.5-0.8 | **0.8 초과** |
| **균등 배분 최대 낙폭** | 25% 초과 | 15-25% | 15% 미만 |
| **개별 코인 수익률 부호** | 3개 이상 손실 | 1-2개 손실 | 전부 수익 |
| **기존 포트폴리오 대비** | 샤프 하락 | 변화 없음 | **샤프 향상** |

### 7.4 포트폴리오 기여도 분석

```
한계 샤프 = 포트폴리오(기존 + 신규)의 샤프 - 포트폴리오(기존만)의 샤프

한계 샤프 > 0 → 기여한다 (상관계수가 낮을수록 기여가 크다)
한계 샤프 ≤ 0 → 기여 없음 → 폐기
```

**수익률 상관관계 확인:**
- 기존 전략들과의 상관관계 0.5 미만 → 분산 효과 기대
- 상관관계 0.7 초과 → 중복 전략 → 편입할 가치 없음

### 7.5 MC Coin Bot 실전 교훈

```
TSMOM 균등 8자산: 샤프 1.57, 연복리 +57.95%, 최대 낙폭 19.43% → 통과
Donchian 앙상블 균등: 샤프 1.00, 연복리 +6.9%, 최대 낙폭 -5.9% → 통과
Stoch-Mom: 개별 0.50 → 균등 0.20 (분산 효과 없음) → 폐기
Larry-VB: 1봉 보유 × 0.1% 비용 = 연 12.5% 비용 부담 (구조적 문제) → 폐기
Mom-MR 혼합: 같은 시간대에서 추세+평균회귀 = 신호 상쇄 → 폐기

교훈: "단일 지표 < 앙상블, 단일 코인 < 다중 자산. 다양성이 곧 알파다."
```

---

## 8. 6단계: 모의 거래와 관찰 기간

### 8.1 목적

**실제 시장 데이터로 실시간 검증**하되, 진짜 돈은 넣지 않는다.

### 8.2 진행 기준

| 항목 | 기준 |
|------|------|
| 최소 기간 | **2-4주** (또는 거래 50건 이상) |
| 데이터 출처 | 실시간 웹소켓 (1분봉) |
| 비교 대상 | 같은 기간 백테스트 결과와 비교 |
| 허용 체결 편차 | 실제와 예상 ±0.05% 이내 |

### 8.3 백테스트 일치도 점검

```
모의 거래 수익률 대 백테스트 수익률 비교

일치도 = |모의 - 백테스트| / |백테스트| × 100%

10% 미만 → 통과 (EDA와 VBT 간 달성한 수준)
10-20%  → 관찰 (체결 편차/비용 모델 재검토)
20% 초과 → 탈락 (모델과 현실 간 괴리)
```

### 8.4 점검 항목

```
□ 1. 주문 체결률 (100%에 가까운가?)
□ 2. 체결 편차 분포 (예상 범위 안에 있는가?)
□ 3. 지연 시간 (신호 발생부터 체결까지)
□ 4. 펀딩비 영향 (포지션 유지 비용)
□ 5. 유동성 (실제 호가창에서 원하는 수량을 체결할 수 있는가?)
□ 6. 장애 대응 (네트워크 끊김, API 제한 시 올바르게 처리하는가?)
```

---

## 9. 7단계: 실전 배포와 상시 감시

### 9.1 자본 투입은 단계적으로

**절대로 전체 자본을 한꺼번에 넣지 않는다.**

```
1개월 차:   5% (최소 금액)
2개월 차:  25%
3개월 차:  50%
4개월 차: 100% (모든 지표가 정상일 때만)
```

| 단계 | 자본 비율 | 다음 단계 조건 |
|------|----------|---------------|
| **5%** | 최소 | 시스템 안정 가동 확인 |
| **25%** | 소규모 | 1개월간 결함 없는 운영 |
| **50%** | 중규모 | 샤프 0.5 이상 유지 |
| **100%** | 전체 | 3개월 연속 양수 수익 |

### 9.2 상시 감시 지표

```
매일 확인:
  - 일일 수익률 / 누적 수익률
  - 현재 포지션 / 레버리지
  - 미체결 주문 건수
  - API 오류 / 재시도 횟수

매주 확인:
  - 30일 이동 샤프
  - 주간 최대 낙폭
  - 거래 빈도 (예상 범위 안에 있는가?)
  - 체결 편차 통계

매월 확인:
  - 3개월 이동 샤프 (핵심 건강 지표)
  - 요인 분해 (시장 노출 대 순수 알파)
  - 다른 전략들과의 상관관계 변화
  - CUSUM 경보 (구조적 변화 감지)
```

### 9.3 실전 폐기/중단 조건

```
즉시 중단 (비상 차단기):
  - 일일 손실 5% 초과
  - 시스템 오류 3회 연속
  - API 연결 60초 이상 끊김
  - 레버리지 한도 초과

감시 강화 (주의 목록):
  - 1개월 이동 샤프 0.5 미만
  - 최대 낙폭이 백테스트 최대 낙폭의 80%에 도달
  - 거래 빈도가 예상의 50% 미만 또는 200% 이상

전략 은퇴:
  - 3개월 이동 샤프가 0.3 미만으로 지속
  - 최대 낙폭이 백테스트 최대 낙폭을 초과
  - 3개월 연속 마이너스 수익
```

---

## 10. 폐기 기준 종합표

### 10.1 단계별 임계값 한눈에 보기

| 지표 | 1단계 (시제품) | 2단계 (표본 외) | 3단계 (조율) | 4단계 (심층) | 7단계 (실전) |
|------|-------------|---------------|-------------|-------------|-------------|
| **샤프** | 0.5 초과 | 표본 외 0.3 초과 | 1.0 초과 (조율 후) | DSR 0.95 초과 | 3개월 이동 0.3 초과 |
| **최대 낙폭** | 40% 미만 | 30% 미만 | 25% 미만 | 표본 외 40% 미만 | 백테스트 낙폭 미만 |
| **거래 수** | 20회 초과 | 표본 외 10회 초과 | 100회 초과 | 구간당 50회 초과 | 해당 없음 |
| **수익 계수** | 1.0 초과 | 1.2 초과 | 1.5 초과 | 1.3 초과 (표본 외) | 1.2 초과 |
| **PBO** | 해당 없음 | 해당 없음 | 해당 없음 | 40% 미만 | 해당 없음 |
| **전진 분석 효율** | 해당 없음 | 해당 없음 | 해당 없음 | 50% 초과 | 해당 없음 |

### 10.2 무조건 폐기 규칙

```
어느 단계에서든 즉시 폐기:
  1. 샤프가 지속적으로 음수 (계속 돈을 잃는다)
  2. 수익 계수가 1.0 미만 (잃는 돈이 버는 돈보다 많다)
  3. 샤프가 3.0을 넘는다 (과적합 의심 — 코드 점검 후 재평가)
  4. 왜 돈을 버는지 설명할 수 없다 (경제적 논거 없음)

"좀비 전략" 경고 (계속 '관찰' 판정을 받는 전략):
  - 3단계 연속 '관찰'이면 → 폐기
  - "그럭저럭 괜찮아 보이지만 확신이 없는" 전략이 가장 위험하다
  - 명확한 통과나 탈락이 차라리 좋은 신호다
```

### 10.3 역설적 위험 신호

| 현상 | 의미 | 대응 |
|------|------|------|
| 표본 내 샤프가 3.0 초과 | 과적합 또는 버그 | 코드 감사 실행 |
| 표본 외가 표본 내보다 좋음 | 행운 또는 데이터 누수 | 다른 기간으로 재검증 |
| 거래 횟수가 점점 줄어드는 추세 | 시장 레짐 변화 | 전략 적응성 점검 |
| 승률이 95% 이상 | 비현실적 | 미래 정보 참조 점검 |
| 최대 낙폭이 0% | 비현실적 | 비용 모델 점검 |

---

## 11. 파라미터 조율 워크플로우 상세

### 11.1 전체 흐름

```
1단계: 기준선 기록 (기본 파라미터)
  │
2단계: 1차원 민감도 분석 (파라미터를 하나씩 변경)
  │
3단계: 고원 식별 → 가운데 값 선택
  │
4단계: ±20% 동시 변동 시험
  │
5단계: 다른 자산 검증 (다른 코인)
  │
6단계: 전진 분석 재검증 (조율된 파라미터로)
  │
7단계: 최종 파라미터 확정
```

### 11.2 단계별 실행 예시

#### 1단계: 기준선

```bash
# 기본 파라미터로 전체 기간 백테스트
uv run python -m src.cli.backtest run tsmom BTC/USDT \
  --start 2023-01-01 --end 2025-12-31

# 결과 기록
기준선: 샤프=1.04, 연복리=+22%, 최대 낙폭=-21%, 거래 수=142
```

#### 2단계: 1차원 민감도 분석

```bash
# 되돌아보기 기간 변화 (다른 파라미터는 고정)
uv run python -m src.cli.backtest sweep tsmom BTC/USDT \
  --lookback 10,15,20,25,30,35,40,45,50,55,60

# 목표 변동성 변화
uv run python -m src.cli.backtest sweep tsmom BTC/USDT \
  --vol_target 0.10,0.15,0.20,0.25,0.30,0.35,0.40,0.45,0.50
```

#### 3단계: 고원 식별

```
되돌아보기 기간(lookback) 스윕 결과:
  10: 샤프=0.8  ←─ 기간이 너무 짧아서 잡음이 많다
  15: 샤프=0.9
  20: 샤프=1.1  ┐
  25: 샤프=1.2  │ 고원 구간 (샤프 1.0-1.3)
  30: 샤프=1.2  │ ← 가운데 값 선택
  35: 샤프=1.1  │
  40: 샤프=1.0  ┘
  45: 샤프=0.7  ←─ 기간이 너무 길어서 반응이 느리다
  50: 샤프=0.5

→ 고원: 20-40, 선택: lookback=30 (가운데 값)
```

#### 4단계: ±20% 시험

```
최적: lookback=30, vol=0.30
+20%: lookback=36, vol=0.36 → 샤프=1.0 → 통과
-20%: lookback=24, vol=0.24 → 샤프=0.9 → 통과
→ 안정적이다
```

#### 5단계: 다른 자산 검증

```
BTC/USDT: 샤프=1.2 → 통과
ETH/USDT: 샤프=0.9 → 통과
SOL/USDT: 샤프=0.7 → 관찰 (허용 범위)
→ 3개 코인 모두 양수 = 통과
```

### 11.3 "안 되는 전략"을 빨리 포기하는 법

```
위험 신호 1: 고원이 없다
  → 파라미터 공간 전체에서 샤프가 들쑥날쑥 → 유의미한 신호가 없다 → 폐기

위험 신호 2: 최적 파라미터가 탐색 범위의 끝자락에 있다
  → lookback=10 (최소) 또는 60 (최대)에서 최고 성과
  → 범위를 늘리면 더 좋아질까? → 물리적으로 의미 없는 값이다 → 폐기

위험 신호 3: 파라미터끼리 강하게 얽혀 있다
  → lookback=20일 때는 vol=0.3이 최적, lookback=40일 때는 vol=0.15가 최적
  → 파라미터 조합에 과도하게 의존한다 → 과적합

위험 신호 4: 거래 비용을 넣으면 무너진다
  → 비용 0%일 때 샤프 2.0 → 비용 0.1%일 때 샤프 0.3
  → 수익 기회가 거래 비용보다 작다 → 폐기 (Larry-VB 사례)
```

---

## 12. 분석과 기록 표준

### 12.1 전략 카드

모든 전략은 아래 형식으로 문서화한다:

```markdown
# 전략 카드: [전략명]

## 기본 정보
- 작성자 / 버전 / 날짜 / 상태
- 자산군 / 시간대 / 대상 종목

## 가설
- 활용하는 시장 비효율성:
- 경제적 논거:
- 예상 알파 원천: [추세추종 / 평균회귀 / 캐리 / ...]
- 시장 레짐 의존성: [추세장 / 횡보장 / 양쪽 모두]

## 신호 규칙
- 진입 조건:
- 청산 조건:
- 파라미터 (이름, 값, 안정 구간):
- 사용 지표:

## 위험 관리
- 손절 / 추적 손절 / 포지션 크기 결정
- 최대 포지션 수 / 최대 낙폭 한도

## 성과 (단계별)
| 지표 | 표본 내 | 표본 외 | 모의 거래 | 실전 |
|------|---------|---------|----------|------|
| 샤프 비율 | | | | |
| 연복리 수익률 | | | | |
| 최대 낙폭 | | | | |
| 수익 계수 | | | | |
| 거래 횟수 | | | | |

## 검증 결과
- DSR: (N= 시행)
- PBO: (S= 분할)
- 전진 분석 효율: % (N개 구간)
- ±20% 시험: 통과/탈락
- 다른 자산 검증: 검증한 종목들

## 요인 노출도
- 시장 베타:
- 순수 알파 (요인 조정 후):

## 의사결정 기록
| 날짜 | 판정 | 근거 | 결과 |
|------|------|------|------|
```

### 12.2 실험 추적

**빠짐없이 기록해야 할 항목:**

| 항목 | 형식 | 용도 |
|------|------|------|
| **파라미터 조합** | JSON/YAML | DSR의 N 계산 |
| **성과 지표** | CSV/Parquet | 비교 분석 |
| **데이터 기간** | ISO 날짜 형식 | 재현성 |
| **코드 버전** | Git 커밋 해시 | 재현성 |
| **비용 가정** | 왕복 % | 현실성 검증 |
| **판정과 근거** | 마크다운 | 의사결정 추적 |

**도구 선택지:**

| 도구 | 장점 | 추천 대상 |
|------|------|----------|
| **Git + 마크다운** | 단순, 버전 관리 내장 | 소규모 팀 |
| **MLflow** | 파라미터/지표 자동 추적 | 중규모 이상 |
| **Weights & Biases** | 시각화 우수, 클라우드 | 협업 팀 |
| **DVC** | 데이터 버전 관리 | 데이터 이력 관리 |

### 12.3 의사결정 기록 사례

```markdown
## 의사결정 기록: TTM Squeeze

| 날짜 | 단계 | 판정 | 근거 | 첨부 |
|------|------|------|------|------|
| 2026-01-15 | 0단계 | 진행 | 학술 근거 있음, squeeze+momentum 조합 | 평가 22/30 |
| 2026-01-16 | 1단계 | 관찰 | 표본 내 샤프 0.8, 거래 30회 | baseline.csv |
| 2026-01-17 | 2단계 | 관찰 | 표본 외 샤프 0.30, 감쇠 63% | oos_results.csv |
| 2026-01-18 | 3단계 | 폐기 | 고원 없음, ±20% 시험 탈락 | sweep_results.csv |
| 2026-01-18 | - | 교훈 | 단일 시간대 squeeze는 잡음이 너무 많다 | - |
```

---

## 13. 알파 감쇠와 전략 은퇴

### 13.1 알파 감쇠란?

전략이 돈을 버는 능력이 시간이 지나면서 서서히 약해지는 현상이다.

| 시장 | 연간 감쇠율 | 비고 |
|------|-----------|------|
| 미국 주식 | 약 5.6%/년 | - |
| 유럽 주식 | 약 9.9%/년 | - |
| **암호화폐** | **10-20%/년** | 정보 전파가 빠르고, 구조적 비효율이 빠르게 줄어든다 |

### 13.2 감쇠를 감지하는 방법

**방법 1: 이동 샤프 비율 (가장 실용적)**

```python
# 12개월 이동 샤프 계산
rolling_sr = returns.rolling(365).mean() / returns.rolling(365).std() * np.sqrt(365)

# 경보: 3개월 연속 이동 샤프 0.5 미만
```

**방법 2: 알파 감쇠 차트**

```
                  최적 보유 기간
                       ↓
수익 ┤            ╭───╮
     │        ╭───╯   ╰───╮
     │    ╭───╯            ╰───╮
     │────╯                     ╰──── → 보유 기간이 길수록 수익 감소
     │
  0  ├─────────────────────────────
     │
     └──┬──┬──┬──┬──┬──┬──┬──┬──
       5분 15분 30분 1시간 4시간 1일 3일 1주

알파 감쇠가 진행되면:
  - 최적 지점이 왼쪽(짧은 기간)으로 이동한다
  - 최적 지점의 높이가 낮아진다
  → 전략의 수익 기회가 줄어들고 있다
```

**방법 3: CUSUM 필터**

```python
# 누적 편차 감시
threshold = 3 * daily_std
cusum_pos = max(0, cusum_pos + (return_t - expected_return))
cusum_neg = min(0, cusum_neg + (return_t - expected_return))

if cusum_neg < -threshold:
    alert("전략 성과에 구조적 하락이 감지되었다")
```

### 13.3 전략의 생애 주기

```
1기: 발견 (높은 수익, 낮은 경쟁)
  ↓
2기: 활용 (안정적 수익, 경쟁자 증가)
  ↓
3기: 과밀화 (수익 감소, 체결 편차 증가)
  ↓
4기: 소멸 (수익이 0에 수렴하거나 마이너스)
  ↓
5기: 반전 (과도한 군집이 반대 방향의 기회를 만들어냄)
```

### 13.4 전략 유형별 예상 수명

| 전략 유형 | 반감기 | 점검 빈도 |
|----------|--------|----------|
| 초고빈도(HFT) | 시간~일 | 매일 |
| 일중 스윙 | 1-5일 | 매주 |
| 일봉 추세추종 | **3-10개월** | 매월 |
| 주봉 추세 | 6-18개월 | 분기별 |
| 다중 자산 차익 | 12-24개월 | 분기별 |

### 13.5 전략 은퇴 판단

```
즉시 은퇴:
  - 12개월 이동 샤프가 3개월 연속 0.3 미만
  - 알파 기여도가 최고점 대비 400bp 이상 하락
  - 거래 비용이 수익보다 많아짐

자본 축소 (50% 회수):
  - 6개월 이동 샤프 0.5 미만
  - 알파 기여도 200bp 하락

유지:
  - 이동 샤프 0.5 이상
  - 최대 낙폭이 과거 범위 안에 있음
  - 일시적 손실은 정상 범위
```

---

## 14. 2025-2026년 동향과 교훈

### 14.1 주요 동향

| 동향 | 설명 | 영향 |
|------|------|------|
| **온체인 데이터** | 스테이블코인 공급량이 BTC 가격과 상관계수 0.87 | 예측 변수로 유망 |
| **HMM 레짐 탐지** | 은닉 마르코프 모형 기반 3단계 레짐 모형이 표준화 중 | 전략 적응성 향상 |
| **대형 언어모델 전략 탐색** | QuantEvolve 등 AI 기반 전략 생성 | 보조 도구 (반드시 검증 필요) |
| **디파이 차익 거래** | 기존 수단은 포화 → 실물자산 토큰화(RWA, $18B TVL)로 이동 | 새로운 기회 영역 |
| **실행 속도 경쟁** | 호가 차이 0.1-1%로 축소, 50ms 이내 실행 필수 | 저빈도 전략이 오히려 유리 |
| **요인 모멘텀** | 개별 자산이 아닌, 요인 프리미엄 자체의 추세추종 | 메타 전략 기회 |
| **계층적 위험 균형(HRP)** | 평균-분산 최적화 → 계층적 위험 균형으로 이동 | 배분 안정성 향상 |

### 14.2 MC Coin Bot 현황 대비 격차 분석

| 영역 | 현재 수준 | 목표 | 중요도 |
|------|----------|------|--------|
| **백테스트 엔진** | 구축 완료 (VectorBT + Numba) | 유지 | - |
| **검증 체계** | 구축 완료 (CPCV/PBO/DSR) | 유지 | - |
| **이벤트 기반 실행** | 구축 완료 (11개 부품) | 유지 | - |
| **레짐 탐지** | 미구현 | HMM 3단계 레짐 | 높음 |
| **온체인 데이터** | 미연동 | 스테이블코인/NVT | 높음 |
| **실험 추적** | Git만 사용 | MLflow 도입 | 보통 |
| **포트폴리오 최적화** | 균등 배분만 | HRP/위험 균형 | 보통 |
| **알파 감쇠 감시** | 미구현 | CUSUM + 이동 샤프 | 높음 |

### 14.3 실전에서 얻은 교훈 (MC Coin Bot)

```
1. 단일 지표보다 앙상블이 낫다
   → Donchian 앙상블 (4가지 설정 조합)이 단일 Donchian보다 안정적

2. 단일 코인보다 다중 자산이 낫다
   → TSMOM 단일 코인 샤프 1.04 → 8자산 균등 배분 샤프 1.57

3. 거래 빈도 × 비용 = 넘을 수 없는 벽
   → Larry-VB: 연 125건 × 0.1% = 연 12.5% 비용 → 수학적으로 수익 불가

4. 같은 시간대에서 반대 전략을 섞으면 서로 상쇄된다
   → 추세추종-평균회귀 혼합: 추세 신호 + 평균회귀 신호 = 신호 소멸

5. "좋아 보이는" 백테스트를 의심해야 한다
   → 논문에 발표된 전략의 78%가 표본 외에서 실패
   → 발표 후 평균 샤프 63% 하락

6. 거래 비용은 보수적으로 잡아야 한다
   → 백테스트 0.1% → 실전 0.15-0.20% (체결 편차, 펀딩비 포함)
```

---

## 15. MC Coin Bot 적용 안내

### 15.1 현재 전략 상태와 다음 행동

| 전략 | 현재 단계 | 샤프 | 판정 | 다음 행동 |
|------|----------|------|------|----------|
| **TSMOM** | 7단계 | 1.57 (균등) | 통과, 주력 | 상시 감시 유지 |
| **BB-RSI** | 4단계 | - | 통과, 보조 | 심층 검증 진행 |
| **Donchian 앙상블** | 2단계 | 1.00 (균등) | 통과, 후보 | **3단계 파라미터 조율** |
| **TTM Squeeze** | 3단계 | 0.30 (균등) | 관찰, 위험 | 고원 분석 → 폐기 가능성 높음 |
| **Stoch-Mom** | 2단계 | 0.20 (균등) | 탈락 | **폐기** (분산 효과 없음) |
| **MTF-MACD** | 1단계 | - | 탈락 | **폐기** (연간 5건 거래) |
| **Larry-VB** | 1단계 | - | 탈락 | **폐기 완료** (비용 구조) |
| **추세-평균회귀 혼합** | 1단계 | - | 탈락 | **폐기 완료** (알파 상쇄) |

### 15.2 전략 개발 작업 흐름 (MC Coin Bot용)

```bash
# 0단계: 아이디어 문서화
# → docs/research/ 에 마크다운으로 작성

# 1단계: 시제품 만들기 (new-strategy 기능 사용)
# → 4개 파일 구조 자동 생성 + 기본 백테스트

# 2단계: 표본 내/외 검증
uv run python -m src.cli.backtest validate -m quick

# 3단계: 파라미터 스윕
uv run python -m src.cli.backtest sweep {전략명} BTC/USDT \
  --param1 값1,값2,값3 --param2 값1,값2,값3

# 4단계: 심층 검증
uv run python -m src.cli.backtest validate -m milestone  # 전진 분석
uv run python -m src.cli.backtest validate -m final      # CPCV+PBO+DSR

# 5단계: 다중 자산
uv run python -m src.cli.backtest run-multi {전략명}

# 6단계: 모의 거래 (이벤트 기반 실행)
uv run python main.py eda run config/{전략명}.yaml

# 7단계: 실전 배포
uv run python main.py eda run config/{전략명}.yaml --live
```

### 15.3 자주 쓰는 CLI 명령어

```bash
# 전략 목록 보기
uv run python -m src.cli.backtest strategies

# 전략 상세 정보
uv run python -m src.cli.backtest info {전략명}

# 단일 자산 백테스트
uv run python -m src.cli.backtest run {전략명} {종목} \
  --start YYYY-MM-DD --end YYYY-MM-DD

# QuantStats 보고서 생성
uv run python -m src.cli.backtest run {전략명} {종목} --report

# 코드 감사 (quant-code-audit 기능)
# → 미래 정보 참조, 비용 모델, 손절/추적 손절 작동 점검
```

---

## 부록 가: 보정 샤프 비율 계산 코드

```python
from scipy.stats import norm
import numpy as np

def expected_max_sr(
    mean_sr: float, var_sr: float, nb_trials: int
) -> float:
    """N번 시행에서 기대되는 최대 샤프 비율 (귀무가설 하)"""
    gamma = 0.5772156649  # 오일러-마스케로니 상수
    e = np.exp(1)
    return mean_sr + np.sqrt(var_sr) * (
        (1 - gamma) * norm.ppf(1 - 1 / nb_trials)
        + gamma * norm.ppf(1 - 1 / (nb_trials * e))
    )

def deflated_sharpe_ratio(
    estimated_sr: float,   # 선택된 전략의 샤프
    sr_variance: float,    # 시행 간 샤프 분산 (기본 1.0)
    nb_trials: int,        # 총 시행 횟수 (N)
    backtest_horizon: int, # 백테스트 기간 (일 수 T)
    skewness: float,       # 수익률 왜도
    kurtosis: float,       # 수익률 첨도
) -> float:
    """DSR p-값: 0.95를 넘으면 통과"""
    sr0 = expected_max_sr(0.0, sr_variance, nb_trials)
    numerator = (estimated_sr - sr0) * np.sqrt(backtest_horizon - 1)
    denominator = np.sqrt(
        1 - skewness * estimated_sr
        + ((kurtosis - 1) / 4) * estimated_sr**2
    )
    return float(norm.cdf(numerator / denominator))
```

## 부록 나: 주요 참고 문헌

| 제목 | 저자 | 핵심 내용 |
|------|------|----------|
| Advances in Financial ML | Lopez de Prado | CPCV, PBO, DSR, 메타 라벨링 |
| The Deflated Sharpe Ratio | Bailey & Lopez de Prado | 다중 검정 보정 |
| Prob. of Backtest Overfitting | Bailey 외 | CSCV 알고리즘 |
| Alpha Decay & Transaction Costs | 2025 arXiv | 알파 감쇠 정량화 |
| QuantEvolve | 2025 ACM ICAIF | 대형 언어모델 전략 탐색 |
| Regime Switching Models | 2025 arXiv | 은닉 마르코프 모형 암호화폐 적용 |

## 부록 다: 핵심 공식 모음

```
샤프 비율        = (수익률 - 무위험이자율) / 변동성 × √365
소르티노 비율    = (수익률 - 무위험이자율) / 하방편차 × √365
칼마 비율        = 연복리수익률 / |최대낙폭|
수익 계수        = 총이익 / |총손실|
회복 계수        = |순이익| / |최대낙폭|
승률             = 수익 거래 수 / 전체 거래 수 × 100%
샤프 감쇠율      = 1 - (표본 외 샤프 / 표본 내 샤프)
전진 분석 효율   = 표본 외 연수익률 / 표본 내 연수익률 × 100%
켈리 비율        = 승률 - (1 - 승률) / (평균이익 / 평균손실)
분수 켈리        = 켈리 / 2  (실전에서는 절반만 사용)
```

---

> **이 문서는 계속 갱신해야 한다.** 새로운 전략 개발 경험, 시장 변화, 최신 연구 결과를 반영하여 꾸준히 업데이트한다.
>
> 마지막 갱신: 2026-02-09
