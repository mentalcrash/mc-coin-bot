이 문서는 저의 아이디어나 새로운 지식에 대한 필터 없이 정리한 문서 입니다.
나중에 이 문서의 내용을 참조하여 체계적인 문서를 만듭니다.

## 단순 메모
- 좋은 아키텍쳐는 전략이 엔진(벡테스팅 or 실전)에 영향을 받지 않는다.

## 시스템 아키텍처 구성 요소 (4대 기둥)

### 데이터 핸들러 (Data Handler)

### 전략

### Portfolio Manager
- 자금 관리 (Risk Management): "내 전재산의 10%만 진입하겠다."
- 주문 생성 (Order Generation): "비트코인 0.5개를 시장가로 사라는 주문 생성."

### 실행 핸들러 (Execution Handler)

구분,백테스팅 (Simulation),실전 매매 (Live Trading),공유 여부
데이터 공급,HistoricalCSVDataHandler (과거 파일),LiveApiDataHandler (실시간 API),❌ (인터페이스만 공유)
투자 전략,VW_TSMOM_Strategy,VW_TSMOM_Strategy,⭕ (100% 일치 필수)
자금 관리,PortfolioManager,PortfolioManager,⭕ (대부분 일치)
주문 실행,SimulatedExecutionHandler (가상 체결),BinanceExecutionHandler (실주문),❌ (인터페이스만 공유)



1. 표준 데이터 포맷 (Standardized Input)

모든 전략은 Pandas DataFrame 형태의 동일한 데이터를 받아야 합니다.

필수 컬럼: open, high, low, close, volume (소문자 통일 권장)

인덱스: datetime

2. 표준 출력 포맷 (Standardized Output)

모든 전략의 결과물은 반드시 아래 두 가지 중 하나여야 합니다.

Signal Series: 1 (매수), -1 (매도), 0 (중립)으로 된 시계열 데이터

Weight Series: 포트폴리오 비중 (예: 0.5 = 자산의 50% 투입)

----

티어 시트(tier sheet)

1. 📊 표(Table)로 확인해야 할 '생존 필수 지표'
수익률만 높은 것은 의미가 없습니다. **"얼마나 마음 편하게(안정적으로) 벌었는가?"**를 확인해야 합니다. 아래 4가지 지표는 필수입니다.

지표 (Metric)	설명 (Description)	판단 기준 (Crypto 기준)
CAGR	연평균 성장률. 복리 수익률입니다.	비트코인 홀딩(Buy&Hold)보다 높아야 의미 있음.
MDD (Max Drawdown)	최대 낙폭. 고점 대비 잔고가 얼마나 녹아내렸는가? (가장 중요)	-20% 이내면 훌륭, -50% 넘어가면 멘탈 붕괴로 전략 중단 확률 높음.
Sharpe Ratio	샤프 지수. 감수한 위험 대비 수익. (가성비)	1.0 이상이면 준수, 2.0 이상이면 매우 훌륭.
Win Rate	승률. 100번 매매 중 몇 번 익절했는가?	추세 추종(VW-TSMOM)은 보통 40~50%로 낮음. (크게 먹고 작게 잃는 구조라 괜찮음)

----

2. 📈 차트(Chart)로 확인해야 할 '검증 포인트'
표는 '결과'만 보여주지만, 차트는 '과정'을 보여줍니다. 숫자에 숨겨진 함정을 찾아내는 과정입니다.

① 누적 수익률 곡선 (Equity Curve)

무엇을 보나: 내 전략(Strategy) vs 벤치마크(Bitcoin) 비교.

체크 포인트:

비트코인이 폭락할 때 내 전략은 버텼는가? (방어력)

수익 곡선이 우상향 직선에 가까운가? (계단식 상승이 가장 좋음)

② 언더워터 차트 (Underwater Plot)

무엇을 보나: 전 고점 대비 현재 마이너스 몇 %인지 보여주는 차트입니다. 수면 아래(손실 구간)에 잠겨있는 시간을 시각화합니다.

체크 포인트:

회복 기간: 손실이 발생하고 다시 원금을 회복하는 데 며칠이 걸렸는가? (1년 내내 회복 못 하면 실패한 전략)

③ 롤링 지표 (Rolling Metrics)

무엇을 보나: 전체 기간 평균이 아니라, 특정 기간(예: 6개월)마다 끊어서 본 수익률/변동성.

체크 포인트:

"2021년 불장에서는 잘 벌었는데, 2023년 횡보장에서는 망가지지 않았나?"

특정 시기에만 잘 작동하는 과적합(Overfitting) 여부를 판단합니다.


----

QuantStats
pandas

로그 수익률 / 일반 수익률


----

🏗️ 백테스팅 엔진의 표준 5단계 파이프라인
작성하신 흐름을 구체화하면 다음과 같습니다.

데이터 로딩 (Data Loader): CSV, DB, API에서 원본 데이터(Raw Data)를 가져옵니다.

전처리 및 지표 계산 (Preprocessor): 이동평균선, 변동성 등 전략에 필요한 재료를 미리 계산합니다.

전략 실행 (Strategy Engine): 데이터를 보고 1(매수), -1(매도), 0(대기) 신호를 생성합니다.

백테스팅 수행 (Backtest Engine): (이게 중요) 신호를 실제 수익률로 변환합니다. 수수료, 슬리피지, 복리 계산을 여기서 담당합니다.

성과 분석 (Analyzer): 결과 수익률(Series)을 QuantStats에 넘겨 HTML 티어시트를 뽑습니다.

----

전처리는 -> 전략 로직에서

----
6단계 파이프라인: 백테스팅 vs 실전 매매 비교

단계 (Step),역할,백테스팅 (Backtest Mode),실전 매매 (Live Mode),공유 여부
1. 데이터 로딩,재료 준비,CSV 파일 / DB(과거 데이터 한꺼번에 로드),Exchange API / WebSocket(실시간 데이터 1개씩 수신),❌
2. 전처리,재료 손질,전체 기간 계산(df.rolling 한방에 처리),최근 버퍼(Buffer) 계산(최근 200개만 유지하며 계산),⭕ (로직 동일)
3. 전략 실행,뇌 (판단),과거 시점의 신호 생성(Signal Series),현재 시점의 신호 생성(Scalar 값: Buy/Sell),⭕ (완벽 동일)
4. 포트폴리오,돈 관리,"가상 자본($10,000) 기준목표 수량 계산",실제 지갑 잔고(KRW) 조회목표 수량 계산,⭕ (로직 동일)
5. 실행기,손 (주문),가상 체결 (Paper)(슬리피지/수수료 모델 적용),REST API 주문 (Real)(업비트 서버로 전송),❌
6. 분석기,성적표,"HTML 티어시트 (Post-mortem)(QuantStats, 사후 분석)","대시보드 / 알림 (Monitoring)(텔레그램, 슬랙 실시간 전송)",❌
---

단계,명칭,도구,목적,속도
1,전략 연구 & 벡터 백테스팅,VectorBT,"""이 아이디어(논리)가 돈이 되나?"" 확인",🚀 초고속 (3년치 1초)
2,파라미터 최적화,VectorBT,과적합을 피해 최적의 설정값(고원) 찾기,🚀 초고속
3,이벤트 기반 백테스팅 🌟,Live Engine,"""실전 코드에 버그가 없나?"" 검증",🐢 느림 (for loop)
4,모의 매매 (Dry Run),Exchange API,"네트워크, API 지연 등 물리적 환경 테스트",🐢 실시간 (리얼타임)
5,실전 매매 (Live),Real Money,실제 자금 투입 및 심리 관리,🐢 실시간


----

- 손절 로직은 어디서 가져가는건가요?

✅ 서버 사이드 스탑 (Good & Trendy):

매수 주문을 넣을 때, **"내 주문이 체결되면, 자동으로 $95에 손절 주문도 같이 등록해 줘"**라고 거래소에 명령하는 방식입니다.

장점: 봇이 꺼지거나 인터넷이 끊겨도, 바이낸스 서버가 알아서 손절해 줍니다.

1. 🚀 선물 거래 시 추가 고려사항 (심화)
바이낸스 선물 봇을 만드실 때 다음 두 가지를 꼭 PM이나 실행기에 구현해야 합니다.

① 격리(Isolated) vs 교차(Cross)

초보자는 무조건 격리(Isolated) 모드를 코드로 강제 설정하세요.

교차로 하다가 봇 버그로 손절 안 나가면 선물 지갑 전체가 0원이 될 수 있습니다.

② Reduce-Only (감소 전용)

손절 주문은 반드시 reduceOnly: True 옵션을 줘야 합니다.

상황: 내가 이미 이익을 봐서 롱을 팔았는데, 나중에 가격이 떨어져서 아까 걸어둔 손절 주문이 발동되어 갑자기 숏 포지션이 잡히는 황당한 사고를 막아줍니다.