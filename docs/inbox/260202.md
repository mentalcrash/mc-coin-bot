# ğŸ“‘ [Quant] VW-TSMOM ì „ëµ êµ¬í˜„ ë° VectorBT ì•„í‚¤í…ì²˜ ì„¤ê³„

**Date:** 2026-02-02
**Tags:** #Quant #VectorBT #Architecture #SystemTrading #Python

## 1. ğŸ’¡ í•µì‹¬ ìš”ì•½ (TL;DR)

* **ì „ëµ ë³¸ì§ˆ:** VW-TSMOMì€ ê³¼ê±° ìˆ˜ìµë¥ (Momentum)ì— ê±°ë˜ëŸ‰ ì‹ ë¢°ë„(Volume Weight)ë¥¼ ê²°í•©í•˜ì—¬ ì¶”ì„¸ ê°•ë„ë¥¼ ì‚°ì¶œí•˜ëŠ” ì „ëµì´ë‹¤.
* **ë¦¬ìŠ¤í¬ ê´€ë¦¬:** ë´‡ ê°œë°œ ì‹œ **ê²©ë¦¬ ë§ˆì§„(Isolated)** ë° **ë‹¨ë°©í–¥ ëª¨ë“œ(One-Way)** ì‚¬ìš©ì´ ê¶Œì¥ë˜ë©°, VectorBTì—ì„œëŠ” `sl_stop` íŒŒë¼ë¯¸í„°ë¡œ ì´ë¥¼ ì‹œë®¬ë ˆì´ì…˜í•œë‹¤.
* **ì•„í‚¤í…ì²˜ ì›ì¹™:** 'ì–¸ì œ ì‚´ ê²ƒì¸ê°€(Strategy)'ì™€ 'ì–¼ë§ˆë‚˜ ì‚´ ê²ƒì¸ê°€(PM/Risk)'ì˜ ì„¤ì •ê³¼ ë¡œì§ì„ ì—„ê²©íˆ ë¶„ë¦¬í•´ì•¼ í™•ì¥ì„±ì´ ë³´ì¥ëœë‹¤.

## 2. ğŸ”‘ ì£¼ìš” ê°œë… ë° ë°°ìš´ ì  (Key Insights)

### A. ë§ˆì§„ ë° í¬ì§€ì…˜ ëª¨ë“œ (Margin & Position Modes)

* **ê²©ë¦¬ ë§ˆì§„ (Isolated Margin):** í¬ì§€ì…˜ë³„ë¡œ ì¦ê±°ê¸ˆì„ ë…ë¦½ì‹œì¼œ, ê°•ì œ ì²­ì‚° ì‹œ í•´ë‹¹ í¬ì§€ì…˜ì˜ ì¦ê±°ê¸ˆë§Œ ì†ì‹¤ë¨. ì‹œìŠ¤í…œ íŠ¸ë ˆì´ë”© ì´ˆê¸° ë‹¨ê³„ ë° ì•ˆì „ì„± í™•ë³´ì— í•„ìˆ˜.
* **ë‹¨ë°©í–¥ ëª¨ë“œ (One-Way Mode):** í•˜ë‚˜ì˜ ì¢…ëª©ì— ëŒ€í•´ Long ë˜ëŠ” Short ì¤‘ í•˜ë‚˜ë§Œ ë³´ìœ  ê°€ëŠ¥. ì¶”ì„¸ ì¶”ì¢… ì „ëµ(TSMOM)ì— ì í•©í•˜ë©° `vectorbt`ì˜ ê¸°ë³¸ ë™ì‘ ë°©ì‹(Reversal)ê³¼ ì¼ì¹˜í•¨.
* *Tip:* ë°±í…ŒìŠ¤íŒ… ì‹œ ì „ëµì  ì†ì ˆ(`sl_stop=0.02`)ì´ ê°•ì œ ì²­ì‚°(`1/Leverage`)ë³´ë‹¤ ë¨¼ì € ì‘ë™í•˜ë„ë¡ ì„¤ì •í•˜ì—¬ ë¡œì§ì˜ ê±´ì „ì„±ì„ ê²€ì¦í•´ì•¼ í•œë‹¤.



### B. ì•„í‚¤í…ì²˜: ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬ (Separation of Concerns)

* **Strategy Layer (Signal Logic):** ì‹œì¥ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ **ë°©í–¥(Direction)**ê³¼ **ì‹ í˜¸ ê°•ë„(Strength)**ë¥¼ ê³„ì‚°. ìê¸ˆ ìƒíƒœë¥¼ ëª°ë¼ì•¼ í•¨.
* *Config ì˜ˆ:* `lookback`, `vol_window`, `vol_target`


* **PM Layer (Money Management):** ì „ëµì˜ ì‹ í˜¸ë¥¼ ë°›ì•„ ê³„ì¢Œ ìƒíƒœ(Balance)ì™€ ë¦¬ìŠ¤í¬ ì„±í–¥ì„ ê³ ë ¤í•´ **ì‹¤ì œ ì£¼ë¬¸ëŸ‰(Size)**ì„ ê²°ì •.
* *Config ì˜ˆ:* `init_cash`, `max_leverage`, `sl_stop`, `fees`



### C. VectorBT êµ¬í˜„ ë…¸í•˜ìš°

* **Sizing (`size` vs `size_type`):** `size=np.inf`ëŠ” ì˜¬ì¸(All-in)ì„ ì˜ë¯¸. ì •êµí•œ ìê¸ˆ ê´€ë¦¬ë¥¼ ìœ„í•´ì„œëŠ” `size_type='percent'`ì™€ í•¨ê»˜ êµ¬ì²´ì ì¸ ë¹„ì¤‘(ì˜ˆ: `1.0`)ì„ ì „ë‹¬í•´ì•¼ í•¨.
* **ì¶©ëŒ í•´ê²°:** ì „ëµ ì‹ í˜¸(`entries`)ì™€ ì†ì ˆ(`sl_stop`)ì´ ë™ì‹œì— ë°œìƒí•  ê²½ìš°, VectorBTëŠ” ë‚´ë¶€ ë¡œì§ì— ë”°ë¼ ì²˜ë¦¬í•˜ë˜ `sl_stop`ì€ ì§„ì… í›„ ê°€ê²© ë³€ë™ì— ë°˜ì‘í•˜ëŠ” ì•ˆì „ì¥ì¹˜ë¡œ ë™ì‘í•¨.

## 3. ğŸ› ï¸ ì†”ë£¨ì…˜ ë° ê°€ì´ë“œ (Actionable Solution)

### Step 1. ì„¤ì • ê°ì²´ ë¶„ë¦¬ (Config Separation)

ì „ëµì˜ ìˆ˜í•™ì  íŒŒë¼ë¯¸í„°ì™€ ìê¸ˆ ìš´ìš© íŒŒë¼ë¯¸í„°ë¥¼ Pydantic ëª¨ë¸ë¡œ ë¶„ë¦¬í•˜ì—¬ ì •ì˜.

```python
from pydantic import BaseModel, Field

# 1. ì „ëµ ì„¤ì • (ìˆ˜í•™ì  ë…¼ë¦¬)
class TSMOMConfig(BaseModel):
    lookback: int = 24          # ëª¨ë©˜í…€ ê¸°ê°„
    vol_window: int = 24        # ë³€ë™ì„± ê¸°ê°„
    vol_target: float = 0.15    # ëª©í‘œ ë³€ë™ì„± (ì‹ í˜¸ ê°•ë„ ê³„ì‚°ìš©)

# 2. PM ì„¤ì • (ìê¸ˆ ë° ë¦¬ìŠ¤í¬)
class PortfolioConfig(BaseModel):
    init_cash: float = 10000.0
    leverage: float = 10.0
    sl_stop: float = 0.02       # ì „ëµì  ì†ì ˆ (2%)
    order_size_pct: float = 1.0 # ìì‚° ëŒ€ë¹„ íˆ¬ì… ë¹„ì¤‘ (100%)
    fees: float = 0.0004

```

### Step 2. VectorBT í¬íŠ¸í´ë¦¬ì˜¤ í†µí•© (Implementation)

ë¶„ë¦¬ëœ ì„¤ì •ì„ `vbt.Portfolio.from_signals`ì— ì£¼ì…í•˜ì—¬ ì‹œë®¬ë ˆì´ì…˜ ìˆ˜í–‰.

```python
import vectorbt as vbt

# ê°€ì •: Strategy Layerì—ì„œ ê³„ì‚°ëœ signal_strength (0.0 ~ 2.0 ì‚¬ì´ì˜ ê°’ ë“±)
# final_size = ì‹ í˜¸ ê°•ë„ * ê¸°ë³¸ ë°°íŒ… ë¹„ì¤‘
final_size = signal_strength * pm_config.order_size_pct

pf = vbt.Portfolio.from_signals(
    close=close_price,
    entries=long_entries,
    exits=long_exits,
    short_entries=short_entries,
    short_exits=short_exits,
    
    # [ìê¸ˆ ê´€ë¦¬]
    init_cash=pm_config.init_cash,
    size=final_size,             # ë™ì  ë¹„ì¤‘ ì ìš©
    size_type='percent',         # Equityì˜ %ë¡œ í•´ì„
    accumulate=False,            # ë‹¨ì¼ í¬ì§€ì…˜ ìœ ì§€
    
    # [ë¦¬ìŠ¤í¬ ê´€ë¦¬ & ë¹„ìš©]
    sl_stop=pm_config.sl_stop,   # 2% ì†ì ˆ (ê²©ë¦¬ ë§ˆì§„ ì•ˆì „ì¥ì¹˜ ì—­í•  ê²¸ì„)
    fees=pm_config.fees,
    freq='1h'                    # ì—°ìœ¨í™” ì§€í‘œ ê³„ì‚°ìš©
)

print(pf.stats())

```

## 4. ğŸ“š ì°¸ê³  ìë£Œ (References)

* **VectorBT Docs:** [Portfolio.from_signals](https://www.google.com/search?q=https://vectorbt.dev/api/portfolio/base/%23vectorbt.portfolio.base.Portfolio.from_signals) - íŒŒë¼ë¯¸í„° ìƒì„¸ ì •ì˜
* **Binance Guide:** [Cross vs Isolated Margin](https://www.google.com/search?q=https://www.binance.com/en/support/faq/b4e9e6ad70934bd082e8e09e33e69513)
* **Concept:** Separation of Concerns in Quant Architecture