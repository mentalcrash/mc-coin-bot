---
description: Ruff Linter & Formatter Compliance Standards (Strict Mode) - ì½”ë“œ ìƒì„± ì‹œ ì¦‰ì‹œ ì¤€ìˆ˜
globs: **/*.py
alwaysApply: true
---

# ğŸ§¹ Ruff Compliance & Code Quality Standards

> [!IMPORTANT]
> **ìƒì„± ì „ ê²€ì¦:** ì½”ë“œë¥¼ ì¶œë ¥í•˜ê¸° **ì§ì „**ì— ì•„ë˜ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ ë¨¸ë¦¿ì†ìœ¼ë¡œ ì‹¤í–‰í•˜ì‹­ì‹œì˜¤. ìƒì„± í›„ ìˆ˜ì • íšŸìˆ˜ë¥¼ 0ì— ê°€ê¹ê²Œ ë§Œë“œëŠ” ê²ƒì´ ëª©í‘œì…ë‹ˆë‹¤.

> [!CAUTION]
> **`# noqa`, `# ruff: noqa` ë“± Ruff ë¬´ë ¥í™” ì£¼ì„ ê¸ˆì§€:** ì½”ë“œ ìƒì„± ì‹œ Ruff ê·œì¹™ì„ ì£¼ì„ìœ¼ë¡œ ë¬´ë ¥í™”í•˜ëŠ” ê²ƒì€ **ì ˆëŒ€ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**. ì§„ì§œ ìµœì•…ì˜ ìµœì•…ì˜ ìµœì•…ì˜ ìƒí™©ì—ì„œë§Œ ì˜ˆì™¸ì ìœ¼ë¡œ í—ˆìš©ë˜ë©°, ê°€ëŠ¥í•˜ë©´ **ì½”ë“œë¥¼ ìˆ˜ì •í•˜ì—¬ ê·œì¹™ì„ ì¤€ìˆ˜**í•˜ëŠ” ë°©í–¥ìœ¼ë¡œ ì‘ì„±í•˜ì‹­ì‹œì˜¤.

## 1. Code Generation Checklist (ì¶œë ¥ ì „ í•„ìˆ˜)

ì½”ë“œ ìƒì„± ì‹œ ë‹¤ìŒì„ **ë°˜ë“œì‹œ** í™•ì¸í•œ í›„ ì¶œë ¥í•˜ì‹­ì‹œì˜¤:

| # | ê·œì¹™ | í™•ì¸ |
|---|------|------|
| 1 | Import: StdLib â†’ Third Party â†’ `from src.*` ìˆœì„œ, `combine-as-imports` (ê°™ì€ ëª¨ë“ˆì€ í•œ ì¤„) | |
| 2 | ë¯¸ì‚¬ìš© import/ë³€ìˆ˜ ì—†ìŒ (F401, F841) | |
| 3 | ë¬¸ìì—´: **Double quotes (`"`)** ë§Œ ì‚¬ìš© | |
| 4 | **ISC001:** ì•”ì‹œì  ë¬¸ìì—´ ì—°ê²° ê¸ˆì§€ (`"a" "b"` âŒ â†’ `"a" + "b"` ë˜ëŠ” `textwrap.dedent` ì‚¬ìš©) | |
| 5 | `inplace=True` ê¸ˆì§€ (PD002), PandasëŠ” ë¶ˆë³€ ì—°ì‚° | |
| 6 | `except:` / `except Exception:` ê¸ˆì§€ â†’ êµ¬ì²´ì  ì˜ˆì™¸ ëª…ì‹œ (TRY002) | |
| 7 | `async def` ë‚´ë¶€ì— `time.sleep()`, `requests.get()` ë“± ë¸”ë¡œí‚¹ í˜¸ì¶œ ê¸ˆì§€ (ASYNC101/102) | |
| 8 | `len(x) > 0` â†’ `if x:` ë“± SIM ê·œì¹™ ì ìš© | |
| 9 | ê²½ë¡œ: `os.path` ëŒ€ì‹  `pathlib.Path` (PTH) | |
| 10 | íƒ€ì… íŒíŠ¸: ëª¨ë“  í•¨ìˆ˜ ì¸ìÂ·ë°˜í™˜ê°’ì— ëª…ì‹œ | |
| 11 | **`# noqa` / `# ruff: noqa` ì‚¬ìš© ê¸ˆì§€** â€” ì½”ë“œ ìˆ˜ì •ìœ¼ë¡œ ê·œì¹™ ì¤€ìˆ˜, ì£¼ì„ ë¬´ë ¥í™”ëŠ” ìµœí›„ì˜ ìˆ˜ë‹¨ | |

## 2. pyproject.toml ê·œì¹™ì…‹ ìš”ì•½

**ì ìš© ê·œì¹™:** E, W, F, I, B, UP, N, SIM, C4, ASYNC, S, RUF, PERF, LOG, TC, PTH, PD, TRY, PL, ISC

**ë¬´ì‹œ ê·œì¹™ (ì´ë¯¸ í—ˆìš©ë¨, ì‹ ê²½ ì“°ì§€ ì•Šì•„ë„ ë¨):**
- `E501` (ì¤„ ê¸¸ì´) â€” formatterê°€ ì²˜ë¦¬
- `B008` (í•¨ìˆ˜ í˜¸ì¶œ ì¸ì) â€” FastAPI Depends ë“±
- `S101` (assert) â€” í…ŒìŠ¤íŠ¸ì—ì„œ í—ˆìš©
- `S311` (random) â€” ë³´ì•ˆ ë¶ˆí•„ìš” ì‹œ
- `RUF012` (í´ë˜ìŠ¤ ë³€ìˆ˜ íƒ€ì…)
- `TRY003` (ê¸´ ì—ëŸ¬ ë©”ì‹œì§€) â€” í—ˆìš©
- `ISC003` (ëª…ì‹œì  ë¬¸ìì—´ ì—°ê²°)
- `PLR0915`, `PLR0913`, `PLC0415` (ì¸ì/ë©”ì„œë“œ ìˆ˜)

**Per-file:** `tests/**/*` â†’ S101, PLR2004, PD, N802 ë¬´ì‹œ | `research/**/*` â†’ T201, PD ë¬´ì‹œ

## 3. ê·œì¹™ë³„ ìƒì„¸ (ìì£¼ ìœ„ë°˜ë˜ëŠ” í•­ëª©)

### ğŸ¼ Pandas (PD)
- **PD002:** `inplace=True` ê¸ˆì§€ â†’ `df = df.fillna(0)`
- **PD901:** `df` ë³€ìˆ˜ëª… ì§€ì–‘ â†’ `prices_df`, `ohlcv` ë“± êµ¬ì²´ì  ì´ë¦„
- ë²¡í„°í™”: `iterrows`, `itertuples` ì‚¬ìš© ê¸ˆì§€

### ğŸ›¡ï¸ ì˜ˆì™¸ ì²˜ë¦¬ (TRY, B)
- **TRY002:** `except:` ê¸ˆì§€ â†’ `except ValueError:` ë“± êµ¬ì²´ì  ì˜ˆì™¸
- **B904:** `raise X from e` í˜•íƒœë¡œ ì²´ì¸ ìœ ì§€

### âš¡ ë¹„ë™ê¸° (ASYNC)
- **ASYNC101/102:** `async def` ë‚´ `time.sleep()`, `requests.get()` ê¸ˆì§€
- â†’ `await asyncio.sleep()`, `aiohttp` ë“± ì‚¬ìš©

### ğŸ§¹ Import (I, F)
- **I001:** StdLib â†’ Third Party â†’ First Party (`src`) ìˆœì„œ
- **combine-as-imports:** `from foo import a, b` í•œ ì¤„ë¡œ
- **known-first-party:** `src` íŒ¨í‚¤ì§€ëŠ” First Party
- **F401:** ë¯¸ì‚¬ìš© import ê¸ˆì§€
- **F841:** ë¯¸ì‚¬ìš© ë³€ìˆ˜ ê¸ˆì§€

### ğŸ“œ ìŠ¤íƒ€ì¼ (N, SIM, ISC)
- **N802:** í•¨ìˆ˜ëª… `snake_case`
- **N806:** ë³€ìˆ˜ëª… `snake_case`
- **SIM:** `if len(x) > 0` â†’ `if x`, `x == None` â†’ `x is None`
- **ISC001:** `"a" "b"` ì•”ì‹œì  ì—°ê²° ê¸ˆì§€ â†’ `"a" + "b"` ë˜ëŠ” `textwrap.dedent`

### ğŸ“ ê²½ë¡œ (PTH)
- **PTH119:** `Path(__file__).parent` ë“± pathlib ì‚¬ìš©

### ğŸ”’ ë³´ì•ˆ (S)
- **S101:** assertì— ë¯¼ê°ì •ë³´ ê¸ˆì§€ (í…ŒìŠ¤íŠ¸ ì œì™¸)
- **S602:** `subprocess` ì‹œ `shell=True` ê¸ˆì§€

## 4. Format ì„¤ì • (ruff format)

- **quote-style:** `"double"`
- **indent-style:** `space`
- **line-length:** 88
- **skip-magic-trailing-comma:** false (trailing comma ìœ ì§€)

## 5. ì˜ˆì‹œ

### âœ… ì¤€ìˆ˜ ì½”ë“œ
```python
import asyncio
from pathlib import Path

from loguru import logger
from pydantic import ValidationError

from src.models import Order

async def process_order(order_id: str) -> None:
    try:
        await asyncio.sleep(0.1)
        logger.info(f"Processing order: {order_id}")
    except ValidationError as e:
        logger.error(f"Validation failed: {e}")
        raise
```

### âŒ ìœ„ë°˜ ì½”ë“œ
```python
import time  # ASYNC101
from src.models import Order  # I001: First party should be last

def process(id):  # N802, íƒ€ì… íŒíŠ¸ ëˆ„ë½
    try:
        time.sleep(1)  # ASYNC101
        print("done")  # LOG: logger ì‚¬ìš©
    except:  # TRY002
        pass
```
