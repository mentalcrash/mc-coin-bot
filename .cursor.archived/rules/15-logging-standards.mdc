---
description: Logging Standards (Loguru, JSON, Async Safety)
globs: **/*.py
alwaysApply: false
---

# ğŸ“ Modern Logging Standards (2026)

## 1. Core Library: Loguru
- **Standard Lib Ban:** Pythonì˜ ê¸°ë³¸ `logging` ëª¨ë“ˆ ëŒ€ì‹ , **`loguru`**ë¥¼ í”„ë¡œì íŠ¸ í‘œì¤€ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
- **No Print:** `print()` ë¬¸ ì‚¬ìš©ì€ ì—„ê²©íˆ ê¸ˆì§€ë©ë‹ˆë‹¤. (ë””ë²„ê¹… ëª©ì ì´ë¼ë„ `logger.debug()` ì‚¬ìš©)
- **Import:** `from loguru import logger`

## 2. Configuration Principles (Production Ready)
- **Dual Sinks:** ë¡œê¹… ì„¤ì •ì€ ë°˜ë“œì‹œ ë‘ ê°€ì§€ ì¶œë ¥ì„ ë™ì‹œì— ì§€ì›í•´ì•¼ í•©ë‹ˆë‹¤.
    1.  **Console (Human):** ê°œë°œìë¥¼ ìœ„í•œ ì»¬ëŸ¬í’€í•˜ê³  ê°€ë…ì„± ë†’ì€ í…ìŠ¤íŠ¸ í¬ë§·.
    2.  **File (Machine):** ë°ì´í„° ë¶„ì„ ë° ELK ìŠ¤íƒ ì—°ë™ì„ ìœ„í•œ **JSON Serialized** í¬ë§·.
- **Async Safety (Critical):**
    - íŠ¸ë ˆì´ë”© ë´‡ì˜ ì´ë²¤íŠ¸ ë£¨í”„ë¥¼ ì°¨ë‹¨í•˜ì§€ ì•Šê¸° ìœ„í•´ íŒŒì¼ ë¡œê·¸ ê¸°ë¡ ì‹œ **ë°˜ë“œì‹œ `enqueue=True`** ì˜µì…˜ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
    - ì˜ˆ: `logger.add("logs/app.log", enqueue=True, ...)`

## 3. Structured Logging (Context Binding)
- **Bind Context:** ë¹„ë™ê¸° í™˜ê²½ì—ì„œëŠ” ë¡œê·¸ê°€ ë’¤ì„ì´ë¯€ë¡œ, ë‹¨ìˆœ í…ìŠ¤íŠ¸ ì—°ê²°ë³´ë‹¤ `logger.bind()`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë©”íƒ€ë°ì´í„°ë¥¼ ì£¼ì…í•©ë‹ˆë‹¤.
    - âœ… `logger.bind(symbol="BTC/USDT", order_id="123").info("Order Placed")`
    - âŒ `logger.info(f"Order Placed for BTC/USDT, id: 123")`
- **Correlation:** ì£¼ë¬¸ íë¦„ ì¶”ì ì„ ìœ„í•´ `execution_id`ë‚˜ `trace_id`ë¥¼ ì ê·¹ì ìœ¼ë¡œ ë°”ì¸ë”©í•©ë‹ˆë‹¤.

## 4. Security & Privacy
- **Secret Masking:** API Key, Secret Key ë“± ë¯¼ê° ì •ë³´ëŠ” ì ˆëŒ€ ë¡œê·¸ì— ë‚¨ê¸°ì§€ ì•ŠìŠµë‹ˆë‹¤.
    - Pydanticì˜ `SecretStr`ì„ ì‚¬ìš©í•˜ë©´ ìë™ ë§ˆìŠ¤í‚¹ë˜ì§€ë§Œ, ë¡œê·¸ ë©”ì‹œì§€ ì‘ì„± ì‹œì—ë„ ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤.
- **Sanitization:** ì˜ˆì™¸ ë°œìƒ ì‹œ `logger.exception()`ì„ ì‚¬ìš©í•˜ë˜, Traceback ë‚´ì— í™˜ê²½ ë³€ìˆ˜ ê°’ì´ ë…¸ì¶œë˜ì§€ ì•Šë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.

## 5. Log Levels Guidelines
- **TRACE:** ë°”ì´ë„ˆë¦¬ ë°ì´í„°, ì›¹ì†Œì¼“ ì›ë³¸ ë©”ì‹œì§€ (ê°œë°œ ë‹¨ê³„ í•œì •).
- **DEBUG:** ë‚´ë¶€ ë¡œì§ íë¦„, ë³€ìˆ˜ ìƒíƒœ ë³€í™”.
- **INFO:** ì‹œìŠ¤í…œ ì‹œì‘/ì¢…ë£Œ, ì£¼ìš” ë§¤ë§¤ ì´ë²¤íŠ¸(ì£¼ë¬¸, ì²´ê²°).
- **WARNING:** ë„¤íŠ¸ì›Œí¬ ì§€ì—°, ì¬ì‹œë„ ê°€ëŠ¥í•œ API ì˜¤ë¥˜ (ì‹œìŠ¤í…œ ì§€ì† ê°€ëŠ¥).
- **ERROR:** ì£¼ë¬¸ ì‹¤íŒ¨, ë°ì´í„° ë¬´ê²°ì„± ê¹¨ì§ (í•´ë‹¹ ì „ëµ/ë£¨í‹´ ì¤‘ë‹¨).
- **CRITICAL:** ìì‚° ì†ì‹¤ ìœ„í—˜, í‚¬ ìŠ¤ìœ„ì¹˜(Kill Switch) ë°œë™ (ì‹œìŠ¤í…œ ì¦‰ì‹œ ì¢…ë£Œ).

## 6. Example Pattern

### âœ… Good (Async-Safe & Structured)
```python
from loguru import logger
import sys

# [ì„¤ì • ì˜ˆì‹œ - src/core/logger.py]
def setup_logger():
    logger.remove() # ê¸°ë³¸ í•¸ë“¤ëŸ¬ ì œê±°
    
    # 1. Console Handler (Readable)
    logger.add(
        sys.stderr,
        format="<green>{time:YYYY-MM-DD HH:mm:ss}</green> | <level>{level: <8}</level> | <cyan>{name}</cyan>:<cyan>{function}</cyan> - <level>{message}</level>",
        level="INFO"
    )
    
    # 2. File Handler (JSON, Async)
    logger.add(
        "logs/trading.json",
        rotation="100 MB",     # íŒŒì¼ í¬ê¸° ê¸°ë°˜ íšŒì „
        retention="10 days",   # ë³´ê´€ ê¸°ê°„
        serialize=True,        # JSON í¬ë§· ì €ì¥
        enqueue=True,          # [ì¤‘ìš”] ë¹„ë™ê¸° í ì‚¬ìš© (Non-blocking)
        level="DEBUG"
    )

# [ì‚¬ìš© ì˜ˆì‹œ]
async def process_trade(symbol: str, side: str):
    # Context Binding
    context_logger = logger.bind(symbol=symbol, side=side)
    
    context_logger.info("Analyzing market data...")
    
    try:
        # ... logic ...
        context_logger.success("Trade executed successfully")
    except Exception as e:
        # Stack trace included
        context_logger.exception("Failed to execute trade")

```

### âŒ Bad (Blocking & Unsafe)

```python
import logging # Legacy

def bad_logging():
    # Blocking IO: ë””ìŠ¤í¬ ì“°ê¸° ì§€ì—° ì‹œ ì „ì²´ ë´‡ ë©ˆì¶¤
    logging.basicConfig(filename='app.log') 
    
    api_key = "sk_12345"
    # ë³´ì•ˆ ìœ„í˜‘: í‚¤ ë…¸ì¶œ + f-string ë‚¨ìš©
    logging.info(f"Connecting with {api_key}") 
    print("Done") # í”„ë¡œë•ì…˜ì—ì„œ í™•ì¸ ë¶ˆê°€

```