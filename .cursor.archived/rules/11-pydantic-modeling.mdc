---
description: Pydantic V2 Data Modeling & Validation Standards
globs: **/models/*.py, **/schemas/*.py, **/config/*.py, **/dtos/*.py
alwaysApply: false
---

# ğŸ›¡ï¸ Pydantic V2 Modeling Standards

## 1. Core Principles (V2 Native)
- **Rust Core Utilization:** Pydantic V2ì˜ ì„±ëŠ¥ ì´ì ì„ ìœ„í•´ ìµœì‹  ë¬¸ë²•ì„ ì¤€ìˆ˜í•©ë‹ˆë‹¤.
- **No V1 Syntax:** `class Config:` ëŒ€ì‹  `model_config = ConfigDict(...)`ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
- **Methods:**
    - `dict()` (Legacy) âŒ -> **`model_dump()`** âœ…
    - `parse_obj()` (Legacy) âŒ -> **`model_validate()`** âœ…
    - `parse_raw()` (Legacy) âŒ -> **`model_validate_json()`** âœ…

## 2. Immutability & Safety (Immutable Models)
- **Frozen Models:** íŠ¸ë ˆì´ë”© ë°ì´í„°(ì£¼ë¬¸ ì •ë³´, ì²´ê²° ë‚´ì—­)ëŠ” ìƒì„± í›„ ë³€ê²½ë˜ë©´ ì•ˆ ë©ë‹ˆë‹¤.
    - ê¸°ë³¸ì ìœ¼ë¡œ `model_config = ConfigDict(frozen=True)`ë¥¼ ì ìš©í•˜ì—¬ ë¶ˆë³€ ê°ì²´ë¡œ ë§Œë“­ë‹ˆë‹¤.
    - ì´ëŠ” ë°ì´í„°ì˜ ìŠ¤ë ˆë“œ ì•ˆì „ì„±(Thread-safety)ì„ ë†’ì´ê³  í•´ì‹œ ê°€ëŠ¥(Hashable)í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤.

## 3. Configuration Management (pydantic-settings)
- **BaseSettings:** í™˜ê²½ ë³€ìˆ˜(.env) ê´€ë¦¬ëŠ” ë°˜ë“œì‹œ `pydantic-settings` íŒ¨í‚¤ì§€ì˜ `BaseSettings`ë¥¼ ìƒì†ë°›ì•„ êµ¬í˜„í•©ë‹ˆë‹¤.
- **Secrets:** API Key, Secret Key ë“±ì€ `str` ëŒ€ì‹  `SecretStr` íƒ€ì…ì„ ì‚¬ìš©í•˜ì—¬ ë¡œê·¸ ì¶œë ¥ ì‹œ ìë™ìœ¼ë¡œ ë§ˆìŠ¤í‚¹(`**********`)ë˜ë„ë¡ í•©ë‹ˆë‹¤.

## 4. Field Validation & Logic
- **Field Validators:** ë‹¨ì¼ í•„ë“œ ê²€ì¦ì€ `@field_validator`ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
- **Model Validators:** ì—¬ëŸ¬ í•„ë“œ ê°„ì˜ ê´€ê³„ ê²€ì¦(ì˜ˆ: ë§¤ë„ ì£¼ë¬¸ ì‹œ ì”ê³  í™•ì¸)ì€ `@model_validator(mode='after')`ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
- **Computed Fields:** ì§ë ¬í™” ì‹œ ê³„ì‚°ëœ ê°’ì„ í¬í•¨í•´ì•¼ í•  ê²½ìš° `@property` ëŒ€ì‹  `@computed_field` ë°ì½”ë ˆì´í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

## 5. Trading Specific Rules
- **Decimal Support:** ê¸ˆì•¡ê³¼ ìˆ˜ëŸ‰ì€ `float` ëŒ€ì‹  `Decimal`ì„ ê°•ì œí•©ë‹ˆë‹¤. Pydanticì€ `Decimal` ì§ë ¬í™”ë¥¼ ì™„ë²½í•˜ê²Œ ì§€ì›í•©ë‹ˆë‹¤.
- **Alias Handling:** ê±°ë˜ì†Œ APIì˜ ì‘ë‹µ(camelCase)ì„ Python ìŠ¤íƒ€ì¼(snake_case)ë¡œ ë§¤í•‘í•  ë•Œ, `Field(alias="orderId")` ë˜ëŠ” `alias_generator`ë¥¼ ì ê·¹ í™œìš©í•©ë‹ˆë‹¤.

## 6. Example Pattern

### âœ… Good (Modern V2 Style)
```python
from decimal import Decimal
from typing import Annotated
from pydantic import BaseModel, ConfigDict, Field, field_validator, SecretStr, computed_field

class ExchangeConfig(BaseModel):
    """ê±°ë˜ì†Œ ì—°ê²° ì„¤ì • ëª¨ë¸"""
    model_config = ConfigDict(frozen=True) # ë¶ˆë³€ ê°ì²´ ì„¤ì •

    api_key: str
    api_secret: SecretStr # ë¡œê·¸ ë…¸ì¶œ ë°©ì§€
    
    @field_validator('api_key')
    @classmethod
    def check_key_length(cls, v: str) -> str:
        if len(v) < 10:
            raise ValueError("API Key seems too short")
        return v

class TradeSignal(BaseModel):
    """ë§¤ë§¤ ì‹ í˜¸ ëª¨ë¸"""
    symbol: str
    price: Decimal = Field(..., gt=0) # 0ë³´ë‹¤ ì»¤ì•¼ í•¨
    quantity: Decimal = Field(..., gt=0)
    
    @computed_field
    def notional_value(self) -> Decimal:
        """ì´ ì£¼ë¬¸ ê¸ˆì•¡ ìë™ ê³„ì‚°"""
        return self.price * self.quantity

```

### âŒ Bad (V1 Legacy Style)

```python
from pydantic import BaseModel, validator

class TradeSignal(BaseModel):
    symbol: str
    price: float # ìœ„í—˜í•œ float ì‚¬ìš©
    
    class Config: # êµ¬í˜• ì„¤ì • ë°©ì‹
        allow_mutation = False
        
    @validator('price') # êµ¬í˜• ê²€ì¦ì
    def check_price(cls, v):
        return v

```